# 1 Bitcoin Coreの基本

2025/10/24
作成，更新 Shigeichiro Yamasaki

## 目次

* シェルスクリプトの利用
* bitcoin クライアントコマンド
* bitcoind の停止と起動
* bitcoin core RPC API
* ビットコインネットワーク
* ビットコインワレット
* トランザクション情報
* トランザクションの構成
* トランザクションのブロードキャスト
* トランザクションの検証
* ブロックチェーン
* プルーフ・オブ・ワークによるマイニングの実行


## シェルスクリプトの利用

bitcoinには直接関係ありませんが，演習を行う上でubuntu や MacOSX のターミナルからのコマンドをプログラミングできるシェルスクリプト言語を知っていると便利で操作を間違えにくくなります．

この演習ではシェルスクリプトを利用するので，簡単に解説しておきます．

### シェルスクリプトとは

Linux のコマンド操作を支援するためのプログラミング言語処理系です．

シャルスクリプトを使うと人間によるコマンド入力をプログラム化して自動実行できるようになります．

## シャルスクリプトの文法


### 変数への代入と評価

#### 代入演算子 '=' 

'=' 演算子を使って文字列や数値などを変数に代入することができます．

```bash
MyAddr="tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh"
```

#### 評価演算子 '$'

評価演算子 '$' によって変数を評価して代入されている文字列を取り出す

```bash
$MyAddr

=>
tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh: コマンドが見つかりません
```

'$' 演算子で出力された文字列はシェルによってさらにコマンドとして評価されます．

ここでは，アドレスの文字列がコマンドと解釈されるので「コマンドが見つかりません」というエラーになります．


date コマンドの場合
```bash
date

=>
2025年  6月 12日 水曜日 19:39:22 JST

D=date

$D
2025年 6月12日 水曜日 19時37分29秒 JST
```

#### ' " （シングルクォートとダブルクォート）

' " （シングルクォートとダブルクォート）は基本的に評価を停止し，囲まれた内容を文字列として扱うことを意味します．

シェルスクリプトでは，' （シングルクオート）や "（ダブルクォート）で囲まなくても文字列として扱われますが，文字列に空白が含まれる場合はクォーテーションで囲む必要があります．

```bash
Wallets='bitcoin-core.cli listwallets'

$Wallets

=>
[
  "alice"
]

```

* echo コマンド

python などのプログラミング言語での print文のように標準出力に文字列を出力するコマンドです．

```bash
echo $MyAddr

=>
tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh
```

空白を含む文字列の場合は クォーテーションをつけます

```bash
echo 'bitcoin-core.cli listwallets'

=>
bitcoin-core.cli listwallets

echo "bitcoin-core.cli listwallets"

=>
bitcoin-core.cli listwallets
```

" （ダブルクォート）の文字列の中で変数を評価することができます．

```bash
echo "bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr"

=>
bitcoin-core.cli -rpcwallet=alice getaddressinfo tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh
```

'（シングルクォート）の文字列の中では変数は評価されません

```bash
echo 'bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr'

=>
bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr
```

* 特殊文字とエスケープ

以下の文字は特殊文字なので，そのまま記述しても文字としては扱われません

```
* ? [ ' " ` \ $ ; & ( ) | ~ < > # % = スペース タブ 改行
```

特殊文字を文字として扱いたい場合は，その前に \（バックスラッシュ）をつけます

```bash
H="\"hello\""

=>
echo $H
"hello"
```

#### ` (バックスラッシュ) と $() によるコマンド置換

` (バックスラッシュ) は，クオートの反対で，囲まれた内容をシェルの処理系で評価することを意味します．

`$()` は ` (バックスラッシュ)の新しい表記方法で，基本的に同じことを意味しますが， \（バックスラッシュ）による特殊文字のエスケープの処理が少し異なっています．

コマンドの中にコマンドの実行結果を埋め込むことができます．

```bash
echo date
=>
date

echo `date`
=>
2024年 6月 13日 木曜日 00:55:18 JST

echo $(date)
=>
2024年 6月 13日 木曜日 00:55:28 JST
```

\（バックスラッシュ）による特殊文字のエスケープの処理の相違点

```bash
echo `echo '\\'`
=>
\

echo $(echo '\\')
=>
\\

```

## bitcoin クライアントコマンド

ubuntu で snap でインストールした場合

```bash
bitcoin-core.cli ＜コマンド＞
```

MacOSX やソースコートからコンパイルしてインストールした場合

```bash
bitcoin-cli ＜コマンド＞
```

以下では　bitcoin-core.cli として説明します。

## bitcoind の停止と起動

* bitcoind の起動

```bash
bitcoin-core.daemon
```

* 起動中の bitcoind を停止させる

```bash
bitcoin-core.cli stop
```

停止後 bitcoind を起動してください

## bitcoin core RPC API

bitcoin core APIの仕様は，以下のリンクにあります。

[ bitcoin-core API](https://developer.bitcoin.org/reference/rpc/)

### help コマンドによるAPIの一覧

```bash
bitcoin-core.cli help

=>
== Blockchain ==
dumptxoutset "path" ( "type" {"rollback":n,...} )
getbestblockhash
getblock "blockhash" ( verbosity )
getblockchaininfo
getblockcount
getblockfilter "blockhash" ( "filtertype" )
getblockfrompeer "blockhash" peer_id

...

```

### help コマンドによるコマンドパラメータの確認

```
bitcoin-core.cli help <コマンド>
```

listunspent コマンドの例

```bash
bitcoin-core.cli help listunspent

=>
listunspent ( minconf maxconf ["address",...] include_unsafe query_options )

Returns array of unspent transaction outputs
with between minconf and maxconf (inclusive) confirmations.
Optionally filter to only include txouts paid to specified addresses.

Arguments:
1. minconf           (numeric, optional, default=1) The minimum confirmations to filter
2. maxconf           (numeric, optional, default=9999999) The maximum confirmations to filter
3. addresses         (json array, optional, default=[]) The bitcoin addresses to filter
     [
       "address",    (string) bitcoin address
       ...
     ]
4. include_unsafe    (boolean, optional, default=true) Include outputs that are not safe to spend
                     See description of "safe" attribute below.
5. query_options     (json object, optional) Options object that can be used to pass named arguments, listed below.

...

```

## ビットコインネットワーク

### bitcoin-cliコマンドを使ったビットコインネットワークの確認

 P2Pネットワークに する情報

```bash
bitcoin-core.cli getnetworkinfo
```

結果

```
{
  "version": 290000,
  "subversion": "/Satoshi:29.0.0/",
  "protocolversion": 70016,
  "localservices": "0000000000000c09",
  "localservicesnames": [
    "NETWORK",
    "WITNESS",
    "NETWORK_LIMITED",
    "P2P_V2"
  ],
  "localrelay": true,
  "timeoffset": 0,
  "networkactive": true,
  "connections": 10,
  "connections_in": 0,
  "connections_out": 10,
  "networks": [
    {
      "name": "ipv4",
      "limited": false,
      "reachable": true,
      "proxy": "",
      "proxy_randomize_credentials": false
    },
    
    ...

```

#### 接続中のノードの情報一覧

```bash
bitcoin-core.cli getpeerinfo
```

結果

```
[
  {
    "id": 0,
    "addr": "103.165.192.206:48333",
    "addrbind": "192.168.0.44:53898",
    "addrlocal": "106.157.214.199:53898",
    "network": "ipv4",
    "services": "0000000000000c09",
    "servicesnames": [
      "NETWORK",
      "WITNESS",
      "NETWORK_LIMITED",
      "P2P_V2"
    ],
    "relaytxes": true,
    "lastsend": 1761290916,
    "lastrecv": 1761290896,
    "last_transaction": 1761290896,
    "last_block": 1761290720,
    "bytessent": 522374,
    "bytesrecv": 788454104,
    "conntime": 1761290370,
    "timeoffset": 0,
    "pingtime": 0.019656,
    "minping": 0.019656,
    "version": 70016,
    "subver": "/Satoshi:29.0.0(@wiz)/",
    "inbound": false,
    "bip152_hb_to": true,
    "bip152_hb_from": false,
    "startingheight": 107768,
    "presynced_headers": -1,
    "synced_headers": 107769,
    "synced_blocks": 107769,
    "inflight": [
    ],

  ...
]
```

## ビットコインワレット

### bitcoin のワレットのロード

コマンドの文法

```
bitcoin-core.cli loadwallet <ラベル>
```

alice のワレットの場合

```bash
bitcoin-core.cli loadwallet alice
=>
{
  "name": "alice"
}
```


#### ビットコインアドレスの生成

コマンドの文法

```
bitcoin-core.cli getnewaddress
```

#### 新しいワレットの生成

★ 自分のワレットの中にアドレスはいくつでも生成できます．
★ アドレスの生成と同時に，対応する秘密鍵と公開鍵も生成されています．

```bash
# alice のワレットをアンロード
bitcoin-core.cli unloadwallet alice
# 新規ワレットの生成
bitcoin-core.cli  createwallet bob
# ワレットのロード（作成時には不要）
bitcoin-core.cli loadwallet bob

####  ワレットの一覧

ロードされているワレットは以下のようにして確認できます

```bash
bitcoin-core.cli listwallets
=>
[
  "bob"
]
```

```bash
bitcoin-core.cli loadwallet alice
bitcoin-core.cli listwallets

=>
[
  "bob",
  "alice"
]
```

ワレットが複数存在している場合は，コマンドの実行のたびにワレット名を指定する必要がある

```bash
bitcoin-core.cli -rpcwallet=bob getnewaddress
```

ワレットを一つにしておく

```bash
# alice のワレットをアンロード
bitcoin-core.cli unloadwallet alice

bitcoin-core.cli listwallets
=>
[
  "bob"
]
```

シェルスクリプトを利用する

```bash


#### コマンド実行結果をシェル変数に代入する

上記の処理を一度に行うには以下のように `\`` (バッククオート)を利用します

```bash
bob1=`bitcoin-core.cli getnewaddress`

# 確認例

echo $bob1
=>
tb1qztkxahtzfpajx8sxxrs80skemuspfq78860j0j
```

#### ビットコインアドレスに対応する公鍵を確認する

コマンドの文法

```
bitcoin-core.cli getaddressinfo <ビットコインアドレス>
```

実際に自分のアドレスの情報を確認してみてください

```bash
# 実行例
bitcoin-core.cli getaddressinfo $bob1

=>
{
  "address": "tb1q2sglcum0q7yy9zp9sdq0svg23qf6nha98eyvs9",
  "scriptPubKey": "00145411fc736f07884288258340f8310a8813a9dfa5",
  "ismine": true,
  "solvable": true,
  "desc": "wpkh([9278fcb8/84h/1h/0h/0/21]03826c491af05c15f1a7508cc7c8c94d8ea1b4b25c6c01b6dd01e1aa4a2fe47261)#z3yuyqfj",
  "parent_desc": "wpkh([9278fcb8/84h/1h/0h]tpubDDhCsJ6XGQpV4ZcobSUHAv88MtVdeYCSW3R4wccKqLHeCTv2y23vzEg948dYybSFfJcsHnXL5D79oXG2Lm3phMG6SGmZXrG4PuNWfYhp8DJ/0/*)#g3xhechk",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "5411fc736f07884288258340f8310a8813a9dfa5",
  "pubkey": "03826c491af05c15f1a7508cc7c8c94d8ea1b4b25c6c01b6dd01e1aa4a2fe47261",
  "ischange": false,
  "timestamp": 1747385736,
  "hdkeypath": "m/84h/1h/0h/0/21",
  "hdseedid": "0000000000000000000000000000000000000000",
  "hdmasterfingerprint": "9278fcb8",
  "labels": [
    ""
  ]
}

```

* 上記の  "pubkey":  の部分がこのアドレスの公開鍵です

### テスト用のビットコインの入手方法

* 残高の確認

まだ bob には所持金は無い

```bash
bitcoin-core.cli getbalance

=>
0.00000000
```

#### testnet4 Faucet からのコインの入手

[https://faucet.testnet4.dev/](https://faucet.testnet4.dev/)

約 約10分程度待つ (30分以上かかることもあります)


 ブロックチェーンエクスプローラでブロックのマイニングの状況を確認するとよくわかります

[https://mempool.space/testnet4](https://mempool.space/testnet4)


### 自分のワレットのビットコインの残高の確認

```bash
# 実行例
bitcoin-core.cli getbalance

#成功していれば，次のような bob の所持金が返ってくる
0.0050000
```

### ビットコインアドレスを宛先にした送金

コマンドの文法

```
sendtoaddress <ビットコインアドレス> <⾦額>
```

#### Bob → Alice への送金

* alice の立場になってアドレスを生成する
  
```bash
bitcoin-core.cli unloadwallet bob
bitcoin-core.cli loadwallet alice
```

```bash
# 実行例
alice1=`bitcoin-core.cli getnewaddress`
```

* bob の立場になって alice に送金する
  
```bash
bitcoin-core.cli unloadwallet alice
bitcoin-core.cli loadwallet bob
```

* 送金金額：0.0005 BTC

```bash
# 実行例
bitcoin-core.cli sendtoaddress $alice1 0.0005

=>
# トランザクションID
6ba5c324f52a0f582373a6d49d771a17a5a31fbbc96368b8e0b20c97268c2106
```

完了まで 10分待つ

#### Alice → Bob への送金

* 送金金額：0.0003 BTC
  
```bash
bitcoin-core.cli -rpcwallet=alice sendtoaddress $bob1 0.0003

=>
# トランザクションID
b1e7bb6591c23dd3ff3e2092b7d21c3c72eaa58a1d36c817994734b7de0097c3
```

## トランザクション情報

### トランザクションの一覧の表示

* 実行例

```bash
bitcoin-core.cli  listtransactions

=>
[
   {
    "address": "tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9",
    "category": "send",
    "amount": -0.00500000,
    "label": "",
    "vout": 0,
    "fee": -0.00000141,
    "confirmations": 2,
    "blockhash": "00000006c87267d3c97c20311b6c820ebc07cd26554abdd6f084f396084c28a1",
    "blockheight": 221390,
    "blockindex": 408,
    "blocktime": 1731234338,
    "txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3",
    "wtxid": "095812e2b7aa3f62cf385afb102651499fffe5af842aba22a7b8930af561e379",
    "walletconflicts": [
    ],
    "mempoolconflicts": [
    ],
    "time": 1731234143,
    "timereceived": 1731234143,
    "bip125-replaceable": "no",
    "abandoned": false
  },
  {
    "address": "tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9",
    "category": "send",
    "amount": -0.00300000,
    "label": "",
    "vout": 1,
    "fee": -0.00000141,
    "confirmations": 2,
    "blockhash": "00000006c87267d3c97c20311b6c820ebc07cd26554abdd6f084f396084c28a1",
    "blockheight": 221390,
    "blockindex": 404,
    "blocktime": 1731234338,
    "txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922",
    "wtxid": "30f01bc131db0fb330105444e30eb81c32b5242674f75332bd3bfcc311f1d8ce",
    "walletconflicts": [
    ],
    "mempoolconflicts": [
    ],
    "time": 1731234206,
    "timereceived": 1731234206,
    "bip125-replaceable": "no",
    "abandoned": false
  }
]
```


## 送金トランザクションの構造の例

### input部分

* UTX0
  * 8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3
  * 金額：0.005
  * アウトプットのインデックス（vout）：0
* UTX1
  * d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922
  * 金額：0.003
  * アウトプットのインデックス（vout）：1

### output部分

* 送金金額：0.006
* 使用するUTXO
  * TXID：$tx1
  * vout：0
* 使用するUTX1
  * TXID：$tx2
  * vout：1
* 手数料：0.00003
* おつり：(0.005+0.003) - 0.006- 0.00003 =  0.00197

#### 送金先アドレスとおつり用アドレスの生成

* 送金先アドレス
  
```bash
bitcoin-core.cli -rpcwallet=alice getnewaddress

=>
＜aliceの新しいアドレス＞

# シェル変数への代入
alice2="＜aliceの新しいアドレス＞"
```

* おつり用アドレスは bobのアドレス

echo は print文に相当するコマンド

```bash
echo $bob1
```

### 未署名のトランザクションの作成

コマンドの文法

```
createrawtransaction <inputのJSON形式> <outputのJSON形式>
```

 * inputのJSON形式

```js
inputs                      (json array, required) The inputs
     [
       {                       (json object)
         "txid": "hex",        (string, required) The transaction id
         "vout": n,            (numeric, required) The output number
         "sequence": n,        (numeric, optional, default=depends on the value of the 'replaceable' and 'locktime' arguments) The sequence number
       },
       ...
     ]
```

* outputのJSON形式

```js
outputs                     (json array, required) The outputs specified as key-value pairs.
                               Each key may only appear once, i.e. there can only be one 'data' output, and no address may be duplicated.
                               At least one output of either type must be specified.
                               For compatibility reasons, a dictionary, which holds the key-value pairs directly, is also
                               accepted as second parameter.
     [
       {                       (json object)
         "address": amount,    (numeric or string, required) A key-value pair. The key (string) is the bitcoin address, the value (float or string) is the amount in BTC
         ...
       },
       {                       (json object)
         "data": "hex",        (string, required) A key-value pair. The key must be "data", the value is hex-encoded data
       },
       ...
     ]
```

作成するトランザクションの　inputのJSON形式の例

```js
'[{"txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3", "vout": 0}, {"txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922", "vout": 1}]'
```

作成するトランザクションの　output　のJSON形式の例

```js
'[{"tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9": 0.006}, {"tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06": 0.00197}]'
```

### UTXOの確認

```bash
 bitcoin-core.cli  -rpcwallet=bob listunspent

[
  {
    "txid": ＜UTXOのトランザクションID＞,
    "vout": ＜UTXOの vtout＞,
    "address": "tb1q3cjsufgy0cp56sl9p5lsfpww8schfhts6pvtlu",
    "label": "",
    "scriptPubKey": "00148e250e25047e034d43e50d3f0485ce3c3174dd70",
    "amount": ＜UTXOの資金＞,
    "confirmations": 12,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([9278fcb8/84h/1h/0h/0/2]0336fba59ab40eb036983aae7f376a1929ddc342151170232d2f3ef118deb25a33)#th0ut73f",
    "parent_descs": [
      "wpkh(tpubD6NzVbkrYhZ4XyV3UcGaHzzXH21ZToEr1Kx55UU3SVR6KTnvjJMP6gDSDo8Q4ZKX2KTkPnipXsEMAz4H5RhyvGbirEFxewpuswV9NAoy226/84h/1h/0h/0/*)#50e604cn"
    ],
    "safe": true
  }
]

```

### 利用する UTXO のトランザクションIDとvout を調べてシェル変数に代入する

```bash
txid="＜UTXOのトランザクションID＞"
vout=＜UTXOの vtout＞
amount= ＜UTXOの資金＞
```

### input の構成

```bash
input="[{\"txid\": \"$txid\", \"vout\": $vout}]"
```

確認例

```bash
echo $input
=>
[{"txid": "4142f1a0f277a666dea86a489aa443b2b8bd544a9a58dfddeaf922e9f948b70b", "vout": 0}]
```

### output の構成

* 手数料： 0.00002 とします
* 送金金額の例： 0.0001
* おつり = ＜UTXOの資金＞ - ＜送金金額＞ - ＜手数料＞
  
例

＜UTXOの資金＞= 0.005
＜送金金額＞= 0.001
＜手数料＞= 0.00002
おつり= 0.00398

```bash
output1="{\"$alice1\": 0.001}"
output2="{\"$bob1\": 0.00398}"
```

確認例

```bash
echo $output1
=>
{"tb1qj8tnqvdj234228y546a54g7ykkeh0akh7y35k0": 0.001}

echo $output2
=>
{"tb1qln4u5rsfjmcjgmlw8n4ecq252ws7skkcr9uuml": 0.00398}
```


### 未署名のトランザクションの作成

```bash
unsigned_tx=`bitcoin-core.cli createrawtransaction "$input" "[$output1,$output2]"`
```

未署名のトランザクションの確認例

```bash
echo $unsigned_tx
=>
02000000010bb748f9e922f9eadddf589a4a54bdb8b243a49a486aa8de66a677f2a0f142410000000000fdffffff02a08601000000000016001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7b012060000000000160014fcebca0e0996f1246fee3ceb9c015453a1e85ad800000000
```

### 作成した未署名トランザクションの確認

```bash
bitcoin-core.cli decoderawtransaction $unsigned_tx

=>
{
  "txid": "b1494b7638eb5607cba8242fffa9287c3dc560e175e522c7137f4cb8fd611bbc",
  "hash": "b1494b7638eb5607cba8242fffa9287c3dc560e175e522c7137f4cb8fd611bbc",
  "version": 2,
  "size": 113,
  "vsize": 113,
  "weight": 452,
  "locktime": 0,
  "vin": [
    {
      "txid": "4142f1a0f277a666dea86a489aa443b2b8bd544a9a58dfddeaf922e9f948b70b",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "sequence": 4294967293
    }
  ],
  "vout": [
    {
      "value": 0.00100000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 91d73031b2546aa51c94aebb4aa3c4b5b377f6d7",
        "desc": "addr(tb1qj8tnqvdj234228y546a54g7ykkeh0akh7y35k0)#t4u3peeg",
        "hex": "001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7",
        "address": "tb1qj8tnqvdj234228y546a54g7ykkeh0akh7y35k0",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00398000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 fcebca0e0996f1246fee3ceb9c015453a1e85ad8",
        "desc": "addr(tb1qln4u5rsfjmcjgmlw8n4ecq252ws7skkcr9uuml)#chqmtsu2",
        "hex": "0014fcebca0e0996f1246fee3ceb9c015453a1e85ad8",
        "address": "tb1qln4u5rsfjmcjgmlw8n4ecq252ws7skkcr9uuml",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}
```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

コマンドの文法

```
signrawtransactionwithwallet <未署名トランザクションの16進数形式>
```
結果

```
{                             (json object)
  "hex" : "hex",              (string) The hex-encoded raw transaction with signature(s)
  "complete" : true|false,    (boolean) If the transaction has a complete set of signatures
  "errors" : [                (json array, optional) Script verification errors (if there are any)
    {                         (json object)
      "txid" : "hex",         (string) The hash of the referenced, previous transaction
      "vout" : n,             (numeric) The index of the output to spent and used as input
      "scriptSig" : "hex",    (string) The hex-encoded signature script
      "sequence" : n,         (numeric) Script sequence number
      "error" : "str"         (string) Verification or signing error related to the input
    },
    ...
  ]
}
```

### 未署名のトランザクションへの署名

bob のワレットの秘密鍵を使う場合

```bash
signed_tx=`bitcoin-core.cli  -rpcwallet=bob signrawtransactionwithwallet $unsigned_tx`

echo $signed_tx
=>
{
  "hex": "020000000001010bb748f9e922f9eadddf589a4a54bdb8b243a49a486aa8de66a677f2a0f142410000000000fdffffff02a08601000000000016001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7b012060000000000160014fcebca0e0996f1246fee3ceb9c015453a1e85ad80247304402202c1155b59e5fd295f4ab6ab161179194bc408f1be190c8540386b446a2bc4e10022013da4176aabb42acbc3cc16be65a63aeaa2f7f31d03c790bbfce587925fd0a7e01210336fba59ab40eb036983aae7f376a1929ddc342151170232d2f3ef118deb25a3300000000",
  "complete": true
}
```

### hex 部分をJSON形式でデコードしてみる

```bash
# 実行例
bitcoin-core.cli decoderawtransaction 020000000001010bb748f9e922f9eadddf589a4a54bdb8b243a49a486aa8de66a677f2a0f142410000000000fdffffff02a08601000000000016001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7b012060000000000160014fcebca0e0996f1246fee3ceb9c015453a1e85ad80247304402202c1155b59e5fd295f4ab6ab161179194bc408f1be190c8540386b446a2bc4e10022013da4176aabb42acbc3cc16be65a63aeaa2f7f31d03c790bbfce587925fd0a7e01210336fba59ab40eb036983aae7f376a1929ddc342151170232d2f3ef118deb25a3300000000

=>
{
  "txid": "b1494b7638eb5607cba8242fffa9287c3dc560e175e522c7137f4cb8fd611bbc",
  "hash": "5eecf07f4638352d1be96c4954fd7fd3d7c1df227198b0af331b60a2a345f7f0",
  "version": 2,
  "size": 222,
  "vsize": 141,
  "weight": 561,
  "locktime": 0,
  "vin": [
    {
      "txid": "4142f1a0f277a666dea86a489aa443b2b8bd544a9a58dfddeaf922e9f948b70b",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "304402202c1155b59e5fd295f4ab6ab161179194bc408f1be190c8540386b446a2bc4e10022013da4176aabb42acbc3cc16be65a63aeaa2f7f31d03c790bbfce587925fd0a7e01",
        "0336fba59ab40eb036983aae7f376a1929ddc342151170232d2f3ef118deb25a33"
      ],
      "sequence": 4294967293
    }
  ],
  "vout": [
    {
      "value": 0.00100000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 91d73031b2546aa51c94aebb4aa3c4b5b377f6d7",
        "desc": "addr(tb1qj8tnqvdj234228y546a54g7ykkeh0akh7y35k0)#t4u3peeg",
        "hex": "001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7",
        "address": "tb1qj8tnqvdj234228y546a54g7ykkeh0akh7y35k0",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00398000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 fcebca0e0996f1246fee3ceb9c015453a1e85ad8",
        "desc": "addr(tb1qln4u5rsfjmcjgmlw8n4ecq252ws7skkcr9uuml)#chqmtsu2",
        "hex": "0014fcebca0e0996f1246fee3ceb9c015453a1e85ad8",
        "address": "tb1qln4u5rsfjmcjgmlw8n4ecq252ws7skkcr9uuml",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}
```

"vin" に "txinwitness" という領域が存在していることを確認してください。

## トランザクションのブロードキャスト

コマンドの文法

```
sendrawtransaction <16進数形式のトランザクション>
```

結果

```
hex string The transaction hash in hex
```

実行例

```bash
bitcoin-core.cli sendrawtransaction 020000000001010bb748f9e922f9eadddf589a4a54bdb8b243a49a486aa8de66a677f2a0f142410000000000fdffffff02a08601000000000016001491d73031b2546aa51c94aebb4aa3c4b5b377f6d7b012060000000000160014fcebca0e0996f1246fee3ceb9c015453a1e85ad80247304402202c1155b59e5fd295f4ab6ab161179194bc408f1be190c8540386b446a2bc4e10022013da4176aabb42acbc3cc16be65a63aeaa2f7f31d03c790bbfce587925fd0a7e01210336fba59ab40eb036983aae7f376a1929ddc342151170232d2f3ef118deb25a3300000000

=>
b1494b7638eb5607cba8242fffa9287c3dc560e175e522c7137f4cb8fd611bbc
```

## トランザクションの検証

トランザクションがブロックに格納されてしまうと失敗します。
トランザクションをブロードキャストする前にリレーするノードのメモリプールでのトランザクションの検証しておくとよいでしょう

コマンドの文法

```
testmempoolaccept <JSON形式 '["16進数形式のトランザクション"]'>
```

結果

```json
[                               (json array) The result of the mempool acceptance test for each raw transaction in the input array.
                                Length is exactly one for now.
  {                             (json object)
    "txid" : "hex",             (string) The transaction hash in hex
    "allowed" : true|false,     (boolean) If the mempool allows this tx to be inserted
    "vsize" : n,                (numeric) Virtual transaction size as defined in BIP 141. This is different from actual serialized size for witness transactions as witness data is discounted (only present when 'allowed' is true)
    "fees" : {                  (json object) Transaction fees (only present if 'allowed' is true)
      "base" : n                (numeric) transaction fee in BTC
    },
    "reject-reason" : "str"     (string) Rejection string (only present when 'allowed' is false)
  },
  ...
]
```

実行例

```bash
bitcoin-core.cli testmempoolaccept  '["03000000000102a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f302473044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c42523532012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae8140247304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a7012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae81400000000"]'

=>
[
  {
    "txid": "466fbc54e6a952eca93bc3073acdfe697b66bb1a124dc69221802c419814a2b5",
    "wtxid": "9d35f4703918b734234ccd11453242a9d43953d58d91c92ddc9c750202784eaa",
    "allowed": false,
    "reject-reason": "txn-already-in-mempool"
  }
]
```

### メモリプール内のtxidを確認する

コマンドの文法

```
getrawmempool
```

結果

```json
[           (json array)
  "hex",    (string) The transaction id
  ...
]
```

実行例

```bash
bitcoin-core.cli getrawmempool

=>
[
  "7cc3a14461355f012be7979ef5e7cbdda509790e2bba3826c4f0b13ab5be76a2",
  "eeadde892ada87f837f7f9160d25a6d61b17ee5b10a263f551feb89c69423613",
  "f1ee23e13b950ef03877a7c6dfdcf60348e98e2362e2c481334e03d6eeafa4fa",
  "c51f714f39b0941b5fbd24d66158616517499b99c52fe4236dcd168003bddff7",
  "43b8e90d25c03e115b43bfcf38c323a79be8ef0990b66196a28004adf8225ef6",
  "701f87223cfa3394801d7d8984bb5d651b48bfbf572af746d1cf8ff07ec515f5",
  "64d3d4ddbca3fd70df465136cf9241ef1c10df199db02d27b38ddf53086b08e8",
  "428590866563fc57d15d43a16442876031ed8a96495f71cfbe2dccec721276e0",
  "77a84ba3eb2010e3d8548a048ce1d050b14e0a41afac04ce720734fb3d121fdf",
  "2b7dc21a27133380ddc4d0d86d5490d52c2668b0851962b171e9d503d3fbbec6",
  "711e0445bff0d9a41d439ec2c88eb3e473ef4968e607882809485bfee0519cc3",
  "9844b12bbea871d9a82242fe7a66dd8c1ddada0c74d77b290b8aeb8d6c8158ba",
  "9d90e9ca270c317b23add12239f770ef47d55a5680daf148f2645e92192a11b6",
  "bfc640cc09840c85044c3692a6956a13b297fcaad68d22f5c1e9d34945a726b4",
  "1728d595c49e3ac479a317dc665b63e7e15f761cfeb6e3c7f22cf140cebe81a3",
  "448806b9e9409a5b51255158f03ff19ab0897cfa58ddc4d308daff86ebeccba1",
  "e96ecc836ea1fb0c788b0216ee9455946f688fbd0c9b24b8808facce32c20392",
  "af50f32472b2d9b12773a6d29a9ff861d93d15d1d6f9c18325dd0c6e6012a18d",
  "d19374e190b2908295674cdf4acc16cdd679e347b9f42338f78a19316bc3a687",
  "9c8e62f6703986c5e0e5ef93e54c562a8f88183d8e927f948ff66f552c3eba7c",
  "f782f6b6287e26acaf7b5e501295daf5b2271d73921e36588e45ba040381ab7c",
  "de1213fe625d360853ba8af0f8b5caac3111e3182c1147c8ee93652af1cdf775",
  "6be18b670305ec4ac592a65ef52eb39f9e93fe96033e70157a49b41057714f74",
  "e583fbccd508c110650c4c8062cfc9e281481ccd5a4d7e6d7dfd724e9857295e",
  "af0841defc307e72aa4b6ffd03cd4c0c0465cbe3339ab7237f997a232479d55c",
  "9e0393211e409f9980730d70a4910f1300cba8e1973436020cebed07250b245b",
  "a8d3430ea3cafdb169e211d2113517d5477f549d7f5b5b2a15a2cad9896c0e5b",
  "b3ba1de977c002dc23162894f5bd0b2a09292630a448fb41f6860705a455ba4f",
  "fcee10370271a6f4864d4331481fbfe71ce5a7102c94af3fb0eaeabd00332649",
  "9e72f22f04921cccc08fb4df12398ef2511d384d5400a0ba099c516c1a61e841",
...

]
```

## ブロックチェーン

### ブロック⾼

コマンドの文法

```
getblockcount
```

実行例

```bash
bitcoin-core.cli getblockcount

=>
82782
```

### ブロックハッシュ

コマンドの文法

```
getblockhash <ブロック⾼>
```

実行例

```bash
bitcoin-core.cli getblockhash 82782

=>
000000003a3f7b423ad9c5d2cc3c82f0419d2ed882fec5bb35e9de7265eedc8e

bitcoin-core.cli getblockhash 0

=>
00000000da84f2bafbbc53dee25a72ae507ff4914b867c565be350b0da8bf043

bitcoin-core.cli getblockhash 1000
=>
00000000b747d47c3b38161693ad05e26924b3775a8be669751f969da836311e
```

どのブロックハッシュも複数の0 で始まっていることに注意してください。
これがマイニングの計算結果です

### ブロックヘッダ

コマンドの文法

```
getblockheader <ブロックハッシュ>
```

結果

```json
{                                 (json object)
  "hash" : "hex",                 (string) the block hash (same as provided)
  "confirmations" : n,            (numeric) The number of confirmations, or -1 if the block is not on the main chain
  "height" : n,                   (numeric) The block height or index
  "version" : n,                  (numeric) The block version
  "versionHex" : "hex",           (string) The block version formatted in hexadecimal
  "merkleroot" : "hex",           (string) The merkle root
  "time" : xxx,                   (numeric) The block time expressed in UNIX epoch time
  "mediantime" : xxx,             (numeric) The median block time expressed in UNIX epoch time
  "nonce" : n,                    (numeric) The nonce
  "bits" : "hex",                 (string) The bits
  "difficulty" : n,               (numeric) The difficulty
  "chainwork" : "hex",            (string) Expected number of hashes required to produce the current chain
  "nTx" : n,                      (numeric) The number of transactions in the block
  "previousblockhash" : "hex",    (string) The hash of the previous block
  "nextblockhash" : "hex"         (string) The hash of the next block
}
```

実行例

```bash
# (ブロック高1000)
bitcoin-core.cli getblockheader 000000003a3f7b423ad9c5d2cc3c82f0419d2ed882fec5bb35e9de7265eedc8e

=>
{
  "hash": "000000003a3f7b423ad9c5d2cc3c82f0419d2ed882fec5bb35e9de7265eedc8e",
  "confirmations": 1,
  "height": 82782,
  "version": 536870912,
  "versionHex": "20000000",
  "merkleroot": "0518f381ac2853e071e56788e91af166b58c0556930a4271de0f38706271fd71",
  "time": 1747585837,
  "mediantime": 1747579832,
  "nonce": 1934573830,
  "bits": "1d00ffff",
  "target": "00000000ffff0000000000000000000000000000000000000000000000000000",
  "difficulty": 1,
  "chainwork": "00000000000000000000000000000000000000000000029e072494b142debcd2",
  "nTx": 125,
  "previousblockhash": "00000000a1c2119d3d7a4bf00b3a3b1a3c5fca7278cb00fc306a8846fd781be3"
}
```

### ブロック全体の情報

コマンドの文法

```
getblock <ブロックハッシュ>
```

結果

```
{                                 (json object)
  "hash" : "hex",                 (string) the block hash (same as provided)
  "confirmations" : n,            (numeric) The number of confirmations, or -1 if the block is not on the main chain
  "size" : n,                     (numeric) The block size
  "strippedsize" : n,             (numeric) The block size excluding witness data
  "weight" : n,                   (numeric) The block weight as defined in BIP 141
  "height" : n,                   (numeric) The block height or index
  "version" : n,                  (numeric) The block version
  "versionHex" : "hex",           (string) The block version formatted in hexadecimal
  "merkleroot" : "hex",           (string) The merkle root
  "tx" : [                        (json array) The transaction ids
    "hex",                        (string) The transaction id
    ...
  ],
  "time" : xxx,                   (numeric) The block time expressed in UNIX epoch time
  "mediantime" : xxx,             (numeric) The median block time expressed in UNIX epoch time
  "nonce" : n,                    (numeric) The nonce
  "bits" : "hex",                 (string) The bits
  "difficulty" : n,               (numeric) The difficulty
  "chainwork" : "hex",            (string) Expected number of hashes required to produce the chain up to this block (in hex)
  "nTx" : n,                      (numeric) The number of transactions in the block
  "previousblockhash" : "hex",    (string) The hash of the previous block
  "nextblockhash" : "hex"         (string) The hash of the next block
}
```

実行例

```bash
bitcoin-core.cli getblock 000000003a3f7b423ad9c5d2cc3c82f0419d2ed882fec5bb35e9de7265eedc8e

=>
{
  "hash": "000000003a3f7b423ad9c5d2cc3c82f0419d2ed882fec5bb35e9de7265eedc8e",
  "confirmations": 1,
  "height": 82782,
  "version": 536870912,
  "versionHex": "20000000",
  "merkleroot": "0518f381ac2853e071e56788e91af166b58c0556930a4271de0f38706271fd71",
  "time": 1747585837,
  "mediantime": 1747579832,
  "nonce": 1934573830,
  "bits": "1d00ffff",
  "target": "00000000ffff0000000000000000000000000000000000000000000000000000",
  "difficulty": 1,
  "chainwork": "00000000000000000000000000000000000000000000029e072494b142debcd2",
  "nTx": 125,
  "previousblockhash": "00000000a1c2119d3d7a4bf00b3a3b1a3c5fca7278cb00fc306a8846fd781be3",
  "strippedsize": 22053,
  "size": 36591,
  "weight": 102750,
  "tx": [
    "dcd1f1b802dab82623a6f6aeff077c6f29060cf10315b8013522d1e9e68e7fd6",
    "7ac77bcae7b0f2ba6980bd81d29aca90d3a0cb193eb198be974df0a311c8e62a",
    "1f8dcb99675565ac2dbc676fdac8e30b021077c13852e54938d27bb01eee1b2f",
    "f24cb624f9260c6362a360b287a3a57133d4754c5eeb52b123c28153e325b619",
    "4a315de54bdf45430b5bba7198fa81d4b57d18f28ef2f31a7f71c0f3833f2737",
    "b145bdd6ec47bb06afc73d5617bfd155d5da063c5c050ed1e805237e9932023e",
    "49fe621851cb0f80dbba3b0eaf227f56c5b2167e702d6b6dbf16a3b58cba88cd",
    "ed25ae23707a7a9404cd1eceb75794719b9e2f2efeacbfb5e90177e0043bc371",
    "39544017efed1c787468dbf1590b0ffe270023bdbd3030c927a35aeb4d0cfc83",
    "7960b6b841ee4f87825458c801b3deb67e5c3c804663e449a182d39603d5491b",
    "4e53221c9c434ad0da0a9ab0f88736987a86d95cddf604d6c62ee0f2e7530d41",
    "2a19dfe3a7304ec11f2ffff6cb114ffc4d5ff1bf9399e223fd08c1340ec0d80a",
    "ef9d605764b32efc310212530719481356173a0af0edf7c606a1c0b35a9cebbf",
    "f97a6413c4c7121b842271923819fdf937b9574c064e7cfde3d7205f025f3bd5",
    "24741e5497419578da419928a8d0aab569b6ba0f38ce39dbfcd7e2f274612122",
    "20586378dbe62afdc57eb2ebc90066ce9055f0d23edc70ef0118b541a80a9377",
    "5b26c0f56c595e25c2ee05cb8fa080b7383340cec96d886f234fe313cd2ab32c",
    "88c9e8a4adbc645e8981771ab0c544bf4f850bb3657cfc02ed84642d44eb8d58",
    "c9d9ef9d8d9f8c62d21fcadfcf706f1cf36483cd719b84dac76afdae919bb9c9",
    "ee88be273fe17f41b3a3dc273234461e5d51f0064ad48671d293c4435315c6e4",
    "3aadc8e342af9c4b5e266050b4f65e2317b7fb0d45d2206062f401f43955a3c0",
    "f079e01fb551694148a79c6515d5d6ab9287d547a02b79adea28374079bc342e",
    "dff9b29fdd8ce8040cfce8c00bd6cae244f504e0cfa6f4f9cb9621987f0d1eca",
    "3c4c32a6ab653a151f1cc3ed88fbb90092f3286a989124e9b361f4fa71de254c",
    "f16080cabd555ab03bd98c46b2125317fcd6de013f78135b3c7e80a13d3f6cac",
    "e43087efc0289e12a088f5a1b8402cac57f625fd9e67adde0e306ffd89526d13",
    "731766470a6b95f1ea0e68db9bdcd86389ed94f2ea75007bcd742c4227ee6f16",
    "7b778112799e6478de4b8febc17c826b316ce20c84756a1ec616da35b6818817",
    "3a8a6e432d589478d1f8c4abd4cdc811373d7c01ebbd16f5e699bc4cc4121d1c",
    "90ca450e4059c75c8f8d55e63d6e35eb531bd8aa2c22daaf9fa0dc25c4046b23",
    "b5eb645bdefa4ac05079335f3bd14ccb3e9fe52bf224d4db93bfa7b0afb47e32",
    "33764376901d232b2c798a142d44fac383fc7bf7eb89c46f7d6869890b388f34",
    "88f1e3b525ae14b79d2103fec3378426e6203815f6b773290176c6825c98b440",
    "b9a11d410f64497422b7f4a83f544499ffaafcd6d8b20413889c2db70c86a64f",
    "be60c49f5311eda0747b5fe9c76b5521f147d6d25168c54fec7422ec4296af4f",
    "9db19cf67233b69be75d168cc9f437414a61e2c3a4c7b094b5e535d765017458",
    "1314676468f1eb2295ec4f39d31c250f98aba4b00def7241b526ea97f1f40fab",
    "726c29cd8501f8097b73ef8412a82daa86700691acfb51d1f9824d896db38db6",
    "c328e452d729a369e10af4b0d5aa42099826851cfb2db1d60dc69d32d2e41ac4",
    "e1c677fd064ed680d41a1cf8be69f024f1cb8f5dede038f7d7837b6367329ad1",
    "ac767f6649b168181c44ffb124c6870df17adef8fa3aa34547ac637157c5e3d4",
    "c5dc6f0f878f5f15e6182ec2cdbbf92b1077ee5f986d53eb6539c11f7bc4e3d7",
    "f999a2e6ee5b3fb567f4f5584aa283b9c2787d23f17979f7c20d5964d6b726d9",
    "9300a37a52eca31db8259e5907ec530c3214e33f33b2ab757568ecc0654405e2",
    "3e1eb0ab016765d01646f186da47875c90ee9ca195f6a7f2b29a7183e03f10ef",
    "438b604ec04a0579bb07ce892e67e63cb1364ffc10d7e881f5109876c914e8f5",
    "d6b0b4fcd5aa722488626e2a8ab57d1af1dfce1d6641a53936b7e46df93740ff",
    "dba2b258b2a7bc3b286ee50199d05e4702f0dbbe44234c8a84ef053e5f6d872a",
    "7d7470dbd6c6ac0f6f4dd6c9af8300444bcba4c9b6b9718e8f52591639175846",
    "94322a128a178a0691d0c5cc583ab43cd9d2a5e5274c876aa1e12b922286ea66",
    "0ced85a579c1c97787d5d80ee3c38505657ec913835a0345dbf318db10f1ba9f",
    "490c58fe5c72a20d7f11aa46b6ed8485575399a5e302d514c3ac162528575ce9",
    "ed5485bb4b74b53e6297273d37021ff0fa68df2dd19023f4d0b46b97fd9b9beb",
    "2bbabb9aca0dac3567ca592f326bb34b18564d7d0e4b30cbd803671ac03890f0",
    "73eb11da9460809689ff1d58aa1ce3e73536a1d30ead32567a23bff381f59719",
    "bd36badc280b77a9138999e91dea822e878f696220378acf095a513cd17e3e4e",
    "e4ac7cbcfaff45552f10d38c676be210caf7425dbd52af1236a3f05ede03b261",
    "9d8434e4f84929a11339f9ecd40d41a90f6c1031c9a0089027363ed5716c0fc0",
    "1a5769724f25f84ec94fa4ad030c3d7b6bdc422ff99c227387676b7618f822f1",
    "9f38ec65c2db3cd96c2b92dbb25e77f528a537734edcaeb75e1a9311f6a91aa6",
    "df118a5a5f7cfd413093b863a2da14c6ba6c9ba2f807a107080f64c55b2b39e6",
    "c166f72468ed9a5d41f9c7c2513c0d8e28cbf8545537f140d9ad7a42f0b0436f",
    "317a41740d40a0e075243faecc0e1cdc2d00f93483773c219ee506c209e89bec",
    "42c99f5201bcb42564889737c11efbdc70f60cff05e9db663920e41398f8d61f",
    "52ea2df6c5b8b01f7ca3a46d568565faefbfcd5e7b4aba356df5be506300984f",
    "ef7f5eadc787f7812e4a35611fdcd2458ca9058d0fca0102a562027f10f6e69d",
    "d9ce0058dc12a48bd5f83ef05444b457f020bbb7ef84a4b475392256b2a8103f",
    "c89e1f9e30c9ccb759f5998df41636f50cebc7c9ca09f4a416c059b104777136",
    "c359c8fb9c9081ebe9922d444ee58d3a6cc465948c3ab222219a896aa221714c",
    "0c9d8ff0101634e37c4b8a97bb5438aaee2280b4e2397a03516e518759473511",
    "2c421f9c1778c708dc5b4c0dae82e8fb6e900d0e9cff8e87a147785648cc9719",
    "7a8f77612cecb8ab49f33b0fc557148b5a8ac8767c5510468f92517e7207b768",
    "4b7c14a4a17187c4367c51c218a9816f2285bb1782c1c747eaa7b873d4fd1083",
    "44f299d76f4ff28caf751432062b048c8758d942416d721047d5cb12937272a7",
    "c1ff9f27693994a870a991be4a43ef66bf26972b4d4c26dd3162f7ff60e2d4c3",
    "672514534a743a2aa53b7d2d16efb855b9e4e8a801042ec32b9e86587b84681b",
    "95937eea9d3ab681f95c50935328c8a7c44bec622eeb3aa42141650deb80a62f",
    "a797452f9db798b3fe704828775fd6672c80153ca127b3e1924faa922d693979",
    "d12600b01147dda7cb1bf25e6dd0288c2a0c63f1aa17a511274b9be00e5e8aa8",
    "1001fc59d2ac27ebef5c5661637ba1fd7a5e6e515adedce8340fd06c504ea253",
    "b005cf5c8cbf23d23f3ab92c0785c205a554075af5606dd6bf621174bf80a0c5",
    "5fbe2658531e87108d7888ff92f48c55384ed2157533b0f06a03ccecf0a381c5",
    "01727318ce04e8bedb0ff2838b97cbf18c1cfd955166661a8d1ad6259d08bab1",
    "cf9a268b9aa16a6865f1b6a904521bcb8b4e7de7a628071b13d84389e42ba2c9",
    "d28ac4ad407f2e1fa092af55243394d8d937e20dd671f2f3edabe58cbfe5bb3b",
    "4bee09bfbd74f6d77bf173e12f8f2d26af8560d37e91a06d20f1caef104118e3",
    "162ce8d837beb545e677dd270374a46dae4ca7c8cd7514a6f1846a8a4f0f071e",
    "ec4a985defe5ca4120c1d0f374315e47b8288129d8191bbac41f93953c056c45",
    "b90f26785b85e4249f2a58fbf5629328d98795a03cd20945896575d9e40db689",
    "b8f3551772a991827f285a49ff21ff1d02a2869f38cf540017293f9202601cdf",
    "28a48d2bbeac398700a9962c3a49aa6402f62e8d51123328cfea6f319d5fcdb1",
    "5efc9a93e73171a4d8a151becce046602aa4eafa1a199baddba167b3b30cf877",
    "005170717806bf76099d3e5a1cd6cca1decb03d6a38f1913a589e153799bbc84",
    "4b7b6496d7e93b27bf340493a77bf3e808a717bb0b11cf21799779e44fa53124",
    "c02d91cd5808aefcaf89c83af6a319edff9b277cac1a441d8a3de5692def2d2c",
    "4d6d4f8c5f4419172ab3daf2b69b6f23c36e3631f5e0ac04e6255376d73628fd",
    "c31398cc090e46d18039f11723089dcd6c59545c341627cf2a90138ab6683788",
    "5d064591ab6c3fb12ac6b3ba786da3502f8a0e4f0874f609742132c29c635bf9",
    "f92bdd36cc80c820f2e3611f24bc0082f95c759a00697a936189411e638f3cee",
    "6cf8989854e8ad42804f7209d5cb5c8db4c8b3c2f8e21157945c31aa40b3d951",
    "b78ea3becbbe1453623726fdc9beba28971fff6e24f08e24690209ad2ace015f",
    "be57fea699ea83c6f25dd508e9bf01faa56e3fa2fbccbabcd5177a62446761cd",
    "71d49a2bec47e7a838c5075fb4a1159527f2d1fdc79bc9ec2184f65d6450a93c",
    "8f11de68cd47116442c849f6b07a5bcf6dbee179293fdaddb9a695b695953bb5",
    "fb2e20246c9ae288d56ddaa06af73f37a9ee66acaca769bcb3e261f3fa73214b",
    "26c240eab612610da6577066efabda01e93b4f54e359a63bb26f98140e3afc85",
    "f79bba62e685480ed475325fbeac1ef3ad6688aeffb715fc00871398d480fae5",
    "a911a0fcfd9cab956c511e9f463f2e54b6d9698cd72ec108b1497ed09afef97d",
    "1f693e35e23b66ea78aa552627932abe79e31a336c597bb6052462b6a31337d7",
    "c375824386d9ce41fae66b83a390e72b2dc7131fb4b4f562d74aaad0bc1d556f",
    "35dcd3870e3bee11591b4fa19bd20ea99b7c7b309c5d31221166a30d45b7be99",
    "d83aa8163acd68423e73e3c56c04745c22c83476e3e05b906262afd13b1e85be",
    "90a8c4f9f3150daa181194cf3bd9795bad81303cb15d989e9c81865d2863c808",
    "37ae222907d7708e41c3e61c6285211f8b7f8dd526ffa6377d095a197a4d990f",
    "9a6c1140299776cea8e95be4051808dae1d9f73d05947b3bd145d796e11e782a",
    "180450fc5969e3f9f13ab4c1d5679e51f3594588352da064ff732fa2b997e04f",
    "72a1e06f3376053ec7272e1f1609fc7c84097fdef228e985c5cbada9b91b3fa2",
    "8064e02079135f4f0c00f0761bc634a4d6222c139ef1b0d78bcaf891c83b5b51",
    "20b1662ff69d497c81637e917e2bce1b4db423d38cc6c2f1faa4148fdc10ea68",
    "a13fe6bba2e42a763bf1b67170cdce362b7c0ce6355c42f3bcfdb520e57174b5",
    "57fc81aa956904c663c2efa2a649938e176b1782cbbaebaeea0432dca7b224b9",
    "3c8f64eb73bfc2b2614c7bbc93b8f44039db0b286db560b3a58f10a8b06532cc",
    "3a9c398d3bdb1ac05f35ed13f456fa14485ef1c7c12243f37663a3ddfe8fccd4",
    "75e8a6ae49d83fcba7b1ce222ffce852641177abcd89404241d2f6ff00ff10e2",
    "4eac5e0f79113db728433e45a10295a7cb407b69312e2761aca3da1f8ddf13ee"
  ]
}
```

## プルーフ・オブ・ワークによるマイニングの実行

ブロックのマイニングは次のコマンドで実行できますが，signet はマイニングの成功だけではブロック生成の権限がないので失敗してしまいます。実験するなら regtest モードでノードを起動しましょう。

### bitcoind を regtest で再起動

```bash
# bitcoind を停止
bitcoin-core.cli stop
```

(snap の場合，cd ~/snap/bitcoin-core/common/.bitcoin/)
regtest用の　bitcoin.conf を作成（signetの設定ファイルも別名で保管しておく）

#### bitcoin.conf の修正

```
regtest=1

...
```

```
# bitcoind を regtestモードで再起動
bitcoin-core.daemon &
```

### マイニングしてみる

regtestモードで実際にマイニングしてみます

コマンドの文法

```
generatetoaddress <マイングするブロック数> <ビットコインアドレス> <最大試行回数>
```

結果

```
[           (json array) hashes of blocks generated
  "hex",    (string) blockhash
  ...
]
```

### regtestモードでの ワレットの作成

```bash
## regtestネットワークでのワレット作成
bitcoin-core.cli createwallet miner

## アドレス生成


```bash
bitcoin-core.cli getnewaddress

=>
bcrt1qk7scjj5kjt9l3cqv8hl3v92xrp8dvdcrafy8nm
```
### マイニング 101ブロック

bitcoin では，マイニング成功後に 101 ブロックの後続ブロックが接続されると，コインベースの資金が確定し，マイナー（指定したアドレス）のものになる．


```bash
bitcoin-core.cli generatetoaddress 101 bcrt1qk7scjj5kjt9l3cqv8hl3v92xrp8dvdcrafy8nm 10000000
```

```js
[
  "480d8422ba7c51047424802fbaa817bc4bf187960f99517b2ba2bd1ee56cd928",
  "166fe030cf46378f27649251b32560670485e3502dba8dc21d3e79c7486dd589",
  "1fab94c43db18619b600c82fde57428a474a5d16b464d30b1dc7a3a8d06883e1",
  "6b9d04672d49fd6744185077c4047d74899b402a6312baf147ace0eb98e7aed9",
  "7d7e9091b6258f5f299a5b1e79016a48b985a6baec0c30fe2dc211b3704e22d4",
  "7325f79f170d7e3c8c40f7cc80bee1870523f94344220556d526a08bee7571f0",
  "1c4a96416ae49da9ab7df6229fad3c821e483ae0c952d04353e4eaecc9d249e1",
  "0691b1da1a4399722d25b35289876e7ef7517f432ea0417fe4e14fe9ce12a279",
  "07bb60a379cb99c89147a4924ded9d349aa1f9b5290cb6aa41139e2fb016cf19",
  "116c173e2017b40d1c3c3de6729162eea2064a9221f06a9ebc2f7a21cfca4dba",
  "449569088c13620501a5ac494cee94a9a98a4042b755a336cae4ff631ce51455",
  "5cc0af37d31a8583c316f0244999b7009f2b1dfe9bd0790273d06abda1e70f75",
  "110bdf99e8be6deb549f313f108e53fb7c669df3609cf89661c8ab4317fdd95b",
  "78da9250c08550ebc520b2102684811b567dd32ef2afdc477b99d380745c29f6",
  "781781bba9332121fd6c6faa6423158cda141746ccc31923a1bf84f752293b62",
  "31d7037c44b4115f2d155dc9f2c2ca43d94641a1384d28bb6bddfaf2778cbb1c",
  "3be318d0f04dbf8a86cb504688fb9131cff869b46463dce5471b034f12dfb019",
  "5e9fcad347788d47763f282c738b4c98a8a5fe55c34ea131f613d94ea970ae24",
  "1150e332aef8db38a2f68776bb61931a9420a3939815db5e33c2eebab0bee167",
  "79fc78c1cddcf36f23081af99e4537fb43c8de5bb6922207fc7a73ebbda7b1f4",
  "57b4efb1228270c4758011d9d00e6320773d4a0845c79c2f5783fbc0de247b0f",
  "269077d5802057b18a08e65cbc889561cb5cd314f8e50afd2f6fa1738c34de42",
  "2356adafe8e49e12cf282eb3c3afe359ebe86e4dde66370e83427f0d7ab39fd6",
  "2141c3c766cc160e8fa8c28a7b7311f0b53d8b84cf9df0d2d617078ba646c020",
  "668c7d810fd54883447f0d4050a3a0c69bb85be08d873476ebcb78ffb289954a",
  "057c4d42e4e278cb4c04d499ed9658b8e47524013150d3df245beb4bbddf3535",
  "2ae8f9d56d64aecc21198f2144021cb578eeadd0dfcd82d7906f0cf685c5f249",
  "32ed62855a1a128f4673c36c0d564bba879d0d9458a4ca07b8dec7bce3716523",
  "4de46c86ccb4a12fcb6cbcdaa9da3c2ebff912430815cc8f7659009c8d267fd0",
  "5a0b851a67265460498b57f68d3f2a74b1fb9eb23e768c7c5ce274c706e3a2ad",
  "6700a020026fb62437d3f279ff2e1d7eb41d7602cda2fe391ab0019c6016da55",
  "29b98cc2814139ac46de32a3c231677f5c507f822ca448956cb041d7ab951db6",
  "37b9df77f7c9733311df94f0935e2e07847122e15b75342e96e8612b2e1597a3",
  "7a560d58d8f0e7089cebdb9f071c97eb138392dfebf82c3999d369a0f89ea87d",
  "645f10295f699b0a499924bdfd30a10ac9aaf4859e631f6e1f54a53cd357d11a",
  "10fa7bc3af6d6e5af9ccbe1166f500538a913cf40e0462a6444db2c7e6888b3e",
  "13beeb368aa2d0a29a73f0bfb55e92c84214b036b5a052b0cff35cb8ec307a4c",
  "6f73b1446fd0119a0b6b1c13480bd03d8ee6bd5f7834a6058e8b4ca566627fac",
  "206d8634f0f361474f79ce4c352e68badeaa2a9bc04d6285c1a5b9a99091a937",
  "1a9ae87561b5a731af7d090088743e5af1459aa1ea302870688da889abbe8f0c",
  "4a6eb0fff7d887c5d0abb52a7bf2ae0414fb222aa12dca6931c0c970359ca0cf",
  "1db6c9df9356eb0fedf6b7bc6d46a840a63ba7bfc72d0ea1557f3e26e50c1461",
  "6d5125fdff9fbf4e074e6501e19b6b969de138b53b27d11bf659dfdb69a1e6b0",
  "528e509c768f7a9bf2adf238a6d8fb32f2f61fc478e32b296c6fd97561e43f46",
  "1260728f3a333e1c684ce9924280a97f29b99b51c3c3cbe7dd3a30f4df1c4824",
  "11644cc7907073814586d8baf8b43ebdd32bdc7650f6d5e9d352c8ef47d2259f",
  "1b22bac44794bc7db509dcd2df77b339107edbf319c6e54035c9dbf598b578fa",
  "1ebe8224cf7ebc695e3b92a0401e4848d13b54c8991e2203a4a447c459f17699",
  "2177dce23e210f584e005501dd1b36d25ec5d188399f05cf2113bede1a25d339",
  "50a9c9b8ea1f48a722207110e287b19b1351a6b44dff0db075044853e3ccc03a",
  "6406f45010c627774611787a0ef1e1243b2bd94f13f415d20bcbeeee8927ba19",
  "20d13c92cc91d3d9ddfc359f08ed759474364b367e861f44e2b3f977e52d7806",
  "094bec495fd7d4311643cd434e26fb7dfeebfdf17ea680ace63e49e8ba2079a7",
  "6ee7cc799e693f31a00e90f22f88a0f1408c07aea065668a8b42aa57a5123bc6",
  "1dc7aa38fd2fbf97d7dcb570900768afb20375988ad0c6e9a6b1d60174096b24",
  "294d59accd00609c51e8efa640c01b58d446f4358439f124845e684b8cb22dc6",
  "441638cde32567a0aa7031741429f2d56ffe03a871449596c57e51460e1b57cc",
  "69e53e7bd3d7ac16e5cb9e2c6ef68f319d612509084f4ad73f1d04443550cd4c",
  "697220e576dc698b477236d24c0001e751e960786eb8be45bb2febdcd44c729a",
  "5f95c6a6eba9bc309f45a51eb685a2f5826b41dba0f9bebbb19fdab52523437f",
  "2ba208fa54a7461daac1154d1c584348a0534577256fb93fab028e29f7be0632",
  "36624e5227ff5dec1373206b9693b56ea3743fb9ae33f8aa01aeb8cf08af30ba",
  "4fafc247a3970e53875453ee3f1418ac2b652702d804ba7c91b20733f290630f",
  "2ce51b53b38597c3bca3000ad00ce8dbb6e7fa429e50870b137ea1ba8fae34e8",
  "1f730a2fd9e89d745659fa53e724f55458d301b121f1ac17e0308ae079e91a76",
  "07909d746b1b6097b8b6b57af1dcd5470fd611ea86e8e2948071a695d7a5ca29",
  "2a8e7fe7df87a406aa5eb97aec876cb037e9ac60a6542df1e797cefd366e98cc",
  "5bd79e2d6f38c951f8c8b7d608ea2b56c541239d7b7141f2b35066ff3ef2635c",
  "1f97c435757f73ab5614542df315b8d33cebd8766b6209159974798e7679dc1d",
  "003e740439085f14863cb42460d7dcb08a04c4d7e8753985d6772d15b247193e",
  "045a10c4db6cc7042ade836f79a32b4e35cb8faf71ce60c7bd4e902979bac879",
  "50a325d4da5a8b12c786657515b0d1b26d36319b0bc719049775556dccfb5d2f",
  "753dd6e5a1cb8869d98443eb2dd3c6ed352565dc187bd4c20b5d0c27510be8f8",
  "2cad7cbcfd6063ff6b0e114dc8e076ef9d2af50f995bca6e8f2442474399caa6",
  "65e57a9a1c3c9ba53591dcecf6ad5aa45c1344efd699e48815a1dd510ccfecc2",
  "2bbab5c565e56b093cd527b4e3c15ea6eee99dd9cb95dcc6bb929e851bac79ab",
  "27a40af633bc3c3ea73e3a34b364d04c500a3d7bd3202607697c4d07b29735af",
  "7c2590b4236d60cff67a5128a9b4b0db73a2de764565274d2858f4011c0d772c",
  "2aaa505b7c3d14d8f87836e72d7f1208c07b52e0f4142b2db29cb69594c791e1",
  "4033db8404f283e4a026456daedc32c0f778a34f83ce166b898777f2b320ff1c",
  "4b6072e0178d3c735e7e224c12a0b6d1e319c51107a0400dca39c179aae651f2",
  "2666676428c2087207b2691d21bcb41439b26ace694d0fcda793feedeb6157b0",
  "3c9e16e7c08341909d250ff56efbef2ee662853af65ae1b3c319a7dd984cdb60",
  "79a6f32143357612139f68f8798fefe2b097ee121e65bcf00cf181fa27e3a425",
  "5df096824361b31c4fa14e837fbfaf90d8f3e83c76b2b63773807dba95e5ff36",
  "4bc77ebe46637913269860e90fb08d3d909b5eb3c5c14c7ad824c4c69af37419",
  "7c770a321968bc19798d9846d51170d53a231eba741e2e319b1c6bfe67ddee72",
  "68a4eff5112606457880b2284edd7a9b081467b8862be1b99264453e1809bd6e",
  "00524089052fd11af892ae8cebfcb9ea657488a6dd1558d006d29a9362d2a90d",
  "49170574bc332aa79b48c68c3208f9fdfd7f8199b4f2130a5733ab529b9646c0",
  "0522a00834086eb9c425f07f4dc6d682233814e9a2abfd630a46844f23f73e74",
  "488b851353a509e3a639ff3d368a7bdd95caeb8bec37fec20e159174b235927c",
  "1e67d0925391f59a7293f855f24c42ca1113cb3ac29d998e28a8229996e12dc9",
  "7546847f2139de7e2a3dfe000bf717ef3132e0c336e69389f15e57a5a1136aed",
  "5f1b582fed45bc70b4899d586d3e1a66d8ce80ecfc7fb73cbd51c6b7151a714d",
  "74a17b82b2fc99fc2c7292abc92ce2d3faff7e627619c2f4c3ce72a46033b162",
  "705103075f0821021522e6c21427b5619a7451c780080dfa48e2784124349a26",
  "48c1dd852181462227551e17c36024291cef088580e76ae18b85628cfc9d6a72",
  "5f8e404b25f2f40f83b011c0481fd004756c09d3e12a4864f25240f138c49267",
  "6ca86380318ddeef1f31c43f82a252ff91bb37a5edaf8d30c57e76692c49bfd2",
  "79afcb1da06ed31b49fa7ebaf00ee37f3647af559a2b3089940772db13f988e1"
]
```

### マイニング結果の確認

```bash
# 自分の所持金を確認
bitcoin-core.cli getbalance

50.00000000
```

### signetに環境を戻す

bitcoind を再起動


```bash
# bitcoind を停止
bitcoin-core.cli stop
```

testnet4 用の　bitcoin.conf に戻す（別名で保管から復元）
(snap の場合，cd ~/snap/bitcoin-core/common/.bitcoin/)



