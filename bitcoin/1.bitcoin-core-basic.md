# 1 Bitcoin Coreの基本

2024/11/10
作成，更新 Shigeichiro Yamasaki

## 目次

* bitcoin クライアントコマンド
* bitcoind の停止と起動
* bitcoin core RPC API
* ビットコインネットワーク
* ビットコインワレット
* トランザクション情報
* トランザクションの構成
* トランザクションのブロードキャスト
* トランザクションの検証
* ブロックチェーン
* プルーフ・オブ・ワークによるマイニングの実行
* シェルスクリプトの利用

## bitcoin クライアントコマンド

ubuntu で snap でインストールした場合

```bash
bitcoin-core.cli ＜コマンド＞
```

MacOSX やソースコートからコンパイルしてインストールした場合

```bash
bitcoin-cli ＜コマンド＞
```

以下では　bitcoin-core.cli として説明します。

## bitcoind の停止と起動

bitcoind の起動

```bash
bitcoin-core.daemon
```

起動中の bitcoind を停止させる

```bash
bitcoin-core.cli stop
```

## bitcoin core RPC API

bitcoin core APIの仕様は，以下のリンクにあります。

[ bitcoin-core API](https://developer.bitcoin.org/reference/rpc/)

### help コマンドによるAPIの一覧

```bash
bitcoin-core.cli help

=>
== Blockchain ==
dumptxoutset "path"
getbestblockhash
getblock "blockhash" ( verbosity )
getblockchaininfo
getblockcount
getblockfilter "blockhash" ( "filtertype" )
getblockfrompeer "blockhash" peer_id
getblockhash height
getblockheader "blockhash" ( verbose )
getblockstats hash_or_height ( stats )
getchainstates
getchaintips
getchaintxstats ( nblocks "blockhash" )
getdeploymentinfo ( "blockhash" )
getdifficulty
getmempoolancestors "txid" ( verbose )
getmempooldescendants "txid" ( verbose )
getmempoolentry "txid"
getmempoolinfo
getrawmempool ( verbose mempool_sequence )
gettxout "txid" n ( include_mempool )
gettxoutproof ["txid",...] ( "blockhash" )
gettxoutsetinfo ( "hash_type" hash_or_height use_index )
gettxspendingprevout [{"txid":"hex","vout":n},...]
importmempool "filepath" ( options )
loadtxoutset "path"
preciousblock "blockhash"
pruneblockchain height
savemempool
scanblocks "action" ( [scanobjects,...] start_height stop_height "filtertype" options )
scantxoutset "action" ( [scanobjects,...] )
verifychain ( checklevel nblocks )
verifytxoutproof "proof"

== Control ==
getmemoryinfo ( "mode" )
getrpcinfo
help ( "command" )
logging ( ["include_category",...] ["exclude_category",...] )
stop
uptime

== Mining ==
getblocktemplate {"mode":"str","capabilities":["str",...],"rules":["segwit","str",...],"longpollid":"str","data":"hex"}
getmininginfo
getnetworkhashps ( nblocks height )
getprioritisedtransactions
prioritisetransaction "txid" ( dummy ) fee_delta
submitblock "hexdata" ( "dummy" )
submitheader "hexdata"

== Network ==
addnode "node" "command" ( v2transport )
clearbanned
disconnectnode ( "address" nodeid )
getaddednodeinfo ( "node" )
getaddrmaninfo
getconnectioncount
getnettotals
getnetworkinfo
getnodeaddresses ( count "network" )
getpeerinfo
listbanned
ping
setban "subnet" "command" ( bantime absolute )
setnetworkactive state

== Rawtransactions ==
analyzepsbt "psbt"
combinepsbt ["psbt",...]
combinerawtransaction ["hexstring",...]
converttopsbt "hexstring" ( permitsigdata iswitness )
createpsbt [{"txid":"hex","vout":n,"sequence":n},...] [{"address":amount,...},{"data":"hex"},...] ( locktime replaceable )
createrawtransaction [{"txid":"hex","vout":n,"sequence":n},...] [{"address":amount,...},{"data":"hex"},...] ( locktime replaceable )
decodepsbt "psbt"
decoderawtransaction "hexstring" ( iswitness )
decodescript "hexstring"
descriptorprocesspsbt "psbt" ["",{"desc":"str","range":n or [n,n]},...] ( "sighashtype" bip32derivs finalize )
finalizepsbt "psbt" ( extract )
fundrawtransaction "hexstring" ( options iswitness )
getrawtransaction "txid" ( verbosity "blockhash" )
joinpsbts ["psbt",...]
sendrawtransaction "hexstring" ( maxfeerate maxburnamount )
signrawtransactionwithkey "hexstring" ["privatekey",...] ( [{"txid":"hex","vout":n,"scriptPubKey":"hex","redeemScript":"hex","witnessScript":"hex","amount":amount},...] "sighashtype" )
submitpackage ["rawtx",...] ( maxfeerate maxburnamount )
testmempoolaccept ["rawtx",...] ( maxfeerate )
utxoupdatepsbt "psbt" ( ["",{"desc":"str","range":n or [n,n]},...] )

== Signer ==
enumeratesigners

== Util ==
createmultisig nrequired ["key",...] ( "address_type" )
deriveaddresses "descriptor" ( range )
estimatesmartfee conf_target ( "estimate_mode" )
getdescriptorinfo "descriptor"
getindexinfo ( "index_name" )
signmessagewithprivkey "privkey" "message"
validateaddress "address"
verifymessage "address" "signature" "message"

== Wallet ==
abandontransaction "txid"
abortrescan
addmultisigaddress nrequired ["key",...] ( "label" "address_type" )
backupwallet "destination"
bumpfee "txid" ( options )
createwallet "wallet_name" ( disable_private_keys blank "passphrase" avoid_reuse descriptors load_on_startup external_signer )
createwalletdescriptor "type" ( {"internal":bool,"hdkey":"str",...} )
dumpprivkey "address"
dumpwallet "filename"
encryptwallet "passphrase"
getaddressesbylabel "label"
getaddressinfo "address"
getbalance ( "dummy" minconf include_watchonly avoid_reuse )
getbalances
gethdkeys ( {"active_only":bool,"private":bool,...} )
getnewaddress ( "label" "address_type" )
getrawchangeaddress ( "address_type" )
getreceivedbyaddress "address" ( minconf include_immature_coinbase )
getreceivedbylabel "label" ( minconf include_immature_coinbase )
gettransaction "txid" ( include_watchonly verbose )
getunconfirmedbalance
getwalletinfo
importaddress "address" ( "label" rescan p2sh )
importdescriptors requests
importmulti requests ( options )
importprivkey "privkey" ( "label" rescan )
importprunedfunds "rawtransaction" "txoutproof"
importpubkey "pubkey" ( "label" rescan )
importwallet "filename"
keypoolrefill ( newsize )
listaddressgroupings
listdescriptors ( private )
listlabels ( "purpose" )
listlockunspent
listreceivedbyaddress ( minconf include_empty include_watchonly "address_filter" include_immature_coinbase )
listreceivedbylabel ( minconf include_empty include_watchonly include_immature_coinbase )
listsinceblock ( "blockhash" target_confirmations include_watchonly include_removed include_change "label" )
listtransactions ( "label" count skip include_watchonly )
listunspent ( minconf maxconf ["address",...] include_unsafe query_options )
listwalletdir
listwallets
loadwallet "filename" ( load_on_startup )
lockunspent unlock ( [{"txid":"hex","vout":n},...] persistent )
migratewallet ( "wallet_name" "passphrase" )
newkeypool
psbtbumpfee "txid" ( options )
removeprunedfunds "txid"
rescanblockchain ( start_height stop_height )
restorewallet "wallet_name" "backup_file" ( load_on_startup )
send [{"address":amount,...},{"data":"hex"},...] ( conf_target "estimate_mode" fee_rate options )
sendall ["address",{"address":amount,...},...] ( conf_target "estimate_mode" fee_rate options )
sendmany ( "" ) {"address":amount,...} ( minconf "comment" ["address",...] replaceable conf_target "estimate_mode" fee_rate verbose )
sendtoaddress "address" amount ( "comment" "comment_to" subtractfeefromamount replaceable conf_target "estimate_mode" avoid_reuse fee_rate verbose )
sethdseed ( newkeypool "seed" )
setlabel "address" "label"
settxfee amount
setwalletflag "flag" ( value )
signmessage "address" "message"
signrawtransactionwithwallet "hexstring" ( [{"txid":"hex","vout":n,"scriptPubKey":"hex","redeemScript":"hex","witnessScript":"hex","amount":amount},...] "sighashtype" )
simulaterawtransaction ( ["rawtx",...] {"include_watchonly":bool,...} )
unloadwallet ( "wallet_name" load_on_startup )
upgradewallet ( version )
walletcreatefundedpsbt ( [{"txid":"hex","vout":n,"sequence":n,"weight":n},...] ) [{"address":amount,...},{"data":"hex"},...] ( locktime options bip32derivs )
walletdisplayaddress "address"
walletlock
walletpassphrase "passphrase" timeout
walletpassphrasechange "oldpassphrase" "newpassphrase"
walletprocesspsbt "psbt" ( sign "sighashtype" bip32derivs finalize )

== Zmq ==
getzmqnotifications

```

### help コマンドによるコマンドパラメータの確認

```
bitcoin-core.cli help <コマンド>
```

listunspent コマンドの例

```bash
bitcoin-core.cli help listunspent

=>
listunspent ( minconf maxconf ["address",...] include_unsafe query_options )

Returns array of unspent transaction outputs
with between minconf and maxconf (inclusive) confirmations.
Optionally filter to only include txouts paid to specified addresses.

Arguments:
1. minconf           (numeric, optional, default=1) The minimum confirmations to filter
2. maxconf           (numeric, optional, default=9999999) The maximum confirmations to filter
3. addresses         (json array, optional, default=[]) The bitcoin addresses to filter
     [
       "address",    (string) bitcoin address
       ...
     ]
4. include_unsafe    (boolean, optional, default=true) Include outputs that are not safe to spend
                     See description of "safe" attribute below.
5. query_options     (json object, optional) Options object that can be used to pass named arguments, listed below.

...

```

## ビットコインネットワーク

### bitcoin-cliコマンドを使ったビットコインネットワークの確認

 P2Pネットワークに する情報

```bash
bitcoin-core.cli getnetworkinfo
```

結果

```
{                                                    (json object)
  "version" : n,                                     (numeric) the server version
  "subversion" : "str",                              (string) the server subversion string
  "protocolversion" : n,                             (numeric) the protocol version
  "localservices" : "hex",                           (string) the services we offer to the network
  "localservicesnames" : [                           (json array) the services we offer to the network, in human-readable form
    "str",                                           (string) the service name
    ...
  ],
  "localrelay" : true|false,                         (boolean) true if transaction relay is requested from peers
  "timeoffset" : n,                                  (numeric) the time offset
  "connections" : n,                                 (numeric) the total number of connections
  "connections_in" : n,                              (numeric) the number of inbound connections
  "connections_out" : n,                             (numeric) the number of outbound connections
  "networkactive" : true|false,                      (boolean) whether p2p networking is enabled
  "networks" : [                                     (json array) information per network
    {                                                (json object)
      "name" : "str",                                (string) network (ipv4, ipv6 or onion)
      "limited" : true|false,                        (boolean) is the network limited using -onlynet?
      "reachable" : true|false,                      (boolean) is the network reachable?
      "proxy" : "str",                               (string) ("host:port") the proxy that is used for this network, or empty if none
      "proxy_randomize_credentials" : true|false     (boolean) Whether randomized credentials are used
    },
    ...
  ],
  "relayfee" : n,                                    (numeric) minimum relay fee for transactions in BTC/kB
  "incrementalfee" : n,                              (numeric) minimum fee increment for mempool limiting or BIP 125 replacement in BTC/kB
  "localaddresses" : [                               (json array) list of local addresses
    {                                                (json object)
      "address" : "str",                             (string) network address
      "port" : n,                                    (numeric) network port
      "score" : n                                    (numeric) relative score
    },
    ...
  ],
  "warnings" : "str"                                 (string) any network and blockchain warnings
}
```

#### 接続中のノードの情報一覧

```bash
bitcoin-core.cli getpeerinfo
```

結果

```
[                                  (json array)
  {                                (json object)
    "id" : n,                      (numeric) Peer index
    "addr" : "str",                (string) (host:port) The IP address and port of the peer
    "addrbind" : "str",            (string) (ip:port) Bind address of the connection to the peer
    "addrlocal" : "str",           (string) (ip:port) Local address as reported by the peer
    "network" : "str",             (string) Network (ipv4, ipv6, or onion) the peer connected through
    "mapped_as" : n,               (numeric) The AS in the BGP route to the peer used for diversifying
                                   peer selection (only available if the asmap config flag is set)
    "services" : "hex",            (string) The services offered
    "servicesnames" : [            (json array) the services offered, in human-readable form
      "str",                       (string) the service name if it is recognised
      ...
    ],
    "relaytxes" : true|false,      (boolean) Whether peer has asked us to relay transactions to it
    "lastsend" : xxx,              (numeric) The UNIX epoch time of the last send
    "lastrecv" : xxx,              (numeric) The UNIX epoch time of the last receive
    "last_transaction" : xxx,      (numeric) The UNIX epoch time of the last valid transaction received from this peer
    "last_block" : xxx,            (numeric) The UNIX epoch time of the last block received from this peer
    "bytessent" : n,               (numeric) The total bytes sent
    "bytesrecv" : n,               (numeric) The total bytes received
    "conntime" : xxx,              (numeric) The UNIX epoch time of the connection
    "timeoffset" : n,              (numeric) The time offset in seconds
    "pingtime" : n,                (numeric) ping time (if available)
    "minping" : n,                 (numeric) minimum observed ping time (if any at all)
    "pingwait" : n,                (numeric) ping wait (if non-zero)
    "version" : n,                 (numeric) The peer version, such as 70001
    "subver" : "str",              (string) The string version
    "inbound" : true|false,        (boolean) Inbound (true) or Outbound (false)
    "addnode" : true|false,        (boolean) Whether connection was due to addnode/-connect or if it was an automatic/inbound connection
                                   (DEPRECATED, returned only if the config option -deprecatedrpc=getpeerinfo_addnode is passed)
    "connection_type" : "str",     (string) Type of connection:
                                   outbound-full-relay (default automatic connections),
                                   block-relay-only (does not relay transactions or addresses),
                                   inbound (initiated by the peer),
                                   manual (added via addnode RPC or -addnode/-connect configuration options),
                                   addr-fetch (short-lived automatic connection for soliciting addresses),
                                   feeler (short-lived automatic connection for testing addresses).
                                   Please note this output is unlikely to be stable in upcoming releases as we iterate to
                                   best capture connection behaviors.
    "startingheight" : n,          (numeric) The starting height (block) of the peer
    "banscore" : n,                (numeric) The ban score (DEPRECATED, returned only if config option -deprecatedrpc=banscore is passed)
    "synced_headers" : n,          (numeric) The last header we have in common with this peer
    "synced_blocks" : n,           (numeric) The last block we have in common with this peer
    "inflight" : [                 (json array)
      n,                           (numeric) The heights of blocks we're currently asking from this peer
      ...
    ],
    "whitelisted" : true|false,    (boolean, optional) Whether the peer is whitelisted with default permissions
                                   (DEPRECATED, returned only if config option -deprecatedrpc=whitelisted is passed)
    "permissions" : [              (json array) Any special permissions that have been granted to this peer
      "str",                       (string) bloomfilter (allow requesting BIP37 filtered blocks and transactions),
                                   noban (do not ban for misbehavior; implies download),
                                   forcerelay (relay transactions that are already in the mempool; implies relay),
                                   relay (relay even in -blocksonly mode, and unlimited transaction announcements),
                                   mempool (allow requesting BIP35 mempool contents),
                                   download (allow getheaders during IBD, no disconnect after maxuploadtarget limit),
                                   addr (responses to getADDR avoid hitting the cache and contain random records with the most up-to-date info).

      ...
    ],
    "minfeefilter" : n,            (numeric) The minimum fee rate for transactions this peer accepts
    "bytessent_per_msg" : {        (json object)
      "msg" : n,                   (numeric) The total bytes sent aggregated by message type
                                   When a message type is not listed in this json object, the bytes sent are 0.
                                   Only known message types can appear as keys in the object.
      ...
    },
    "bytesrecv_per_msg" : {        (json object)
      "msg" : n                    (numeric) The total bytes received aggregated by message type
                                   When a message type is not listed in this json object, the bytes received are 0.
                                   Only known message types can appear as keys in the object and all bytes received
                                   of unknown message types are listed under '*other*'.
    }
  },
  ...
]
```

## ビットコインワレット

### bitcoin のワレットのロード

コマンドの文法

```
bitcoin-core.cli loadwallet <ラベル>
```

alice のワレットの場合

```bash
bitcoin-core.cli loadwallet alice
=>
{
  "name": "alice"
}
```

#### ビットコインアドレスの生成

コマンドの文法

```
getnewaddress
```

★ 自分のワレットの中にアドレスはいくつでも生成できます．
★ アドレスの生成と同時に，対応する秘密鍵と公開鍵も生成されています．

```bash
# 新規ワレットの生成
bitcoin-core.cli  createwallet bob
# ワレットのロード（作成時には不要）
bitcoin-core.cli loadwallet bob
# bitcoin アドレスの生成
bitcoin-core.cli getnewaddress
# 生成されたアドレスの例￼
tb1q9q2naqqdaqe06x69xjefe3ttsuj4krqw4zy2xy
# 生成されたアドレスをシェル変数に代入しておく
bob1="tb1q9q2naqqdaqe06x69xjefe3ttsuj4krqw4zy2xy"
```

#### ビットコインアドレスに対応する公鍵を確認する

コマンドの文法

```
getaddressinfo <ビットコインアドレス>
```

実際に自分のアドレスの情報を確認してみてください

```bash
# 実行例
bitcoin-core.cli getaddressinfo $bob1

=>
{
  "address": "tb1q9q2naqqdaqe06x69xjefe3ttsuj4krqw4zy2xy",
  "scriptPubKey": "001428153e800de832fd1b4534b29cc56b87255b0c0e",
  "ismine": true,
  "solvable": true,
  "desc": "wpkh([c7d47d18/0h/1h/1h]02f5e316796010b22880078faa06407372fefa3e2307a67f9132574223aacbda5b)#gkszygfm",
  "parent_desc": "combo(tpubD6NzVbkrYhZ4XGDezh1cSgJUBU9dWUDjpTJEeqUdzgyCoN8GrrqRD8XqoMcTszqs1aevmdxyqKHUP7nyT9Z8SLpg9KDjb3oxCmw8MiXRHwT/0h/1h/*h)#0vdx8xf5",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "28153e800de832fd1b4534b29cc56b87255b0c0e",
  "pubkey": "02f5e316796010b22880078faa06407372fefa3e2307a67f9132574223aacbda5b",
  "ischange": true,
  "timestamp": 0,
  "hdkeypath": "m/0h/1h/1h",
  "hdseedid": "0000000000000000000000000000000000000000",
  "hdmasterfingerprint": "c7d47d18",
  "labels": [
  ]
}
```

*   "pubkey":  の部分が公開鍵です

### テスト用のビットコインの入手方法

* 残高の確認

まだ所持金は無い

```bash
bitcoin-core.cli getbalance

=>
0.00000000
```

#### Signet Faucet からのコインの入手

自分のビットコインアドレスと入手希望金額を入力する

* 送金金額：0.01 btc

[https://signetfaucet.com/](https://signetfaucet.com/)

約 10分以上待つ

### 自分のワレットのビットコインの残高の確認

```bash
# 実行例
bitcoin-core.cli getbalance


#成功していれば，次のような値が返ってくる
0.0100000
```

### ビットコインアドレスを宛先にした送金

コマンドの文法

```
sendtoaddress <ビットコインアドレス> <⾦額>
```

新しいビットコインアドレスを生成する

```bash
# 実行例
bitcoin-core.cli getnewaddress 

# 生成されたアドレスの例￼
tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9  
# シェル変数に代入
bob2="tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9"
```

* 送金金額：0.005
* 送金金額：0.003

```bash
# 実行例
bitcoin-core.cli sendtoaddress $bob2 0.005

=>
# トランザクションID
8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3

bitcoin-core.cli sendtoaddress $bob2 0.003

=>
# トランザクションID
d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922
```

## トランザクション情報

### トランザクションの一覧の表示

コマンドの文法

```bash
listtransactions
```

* 実行例

```bash
bitcoin-core.cli listtransactions

=>
[
   {
    "address": "tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9",
    "category": "send",
    "amount": -0.00500000,
    "label": "",
    "vout": 0,
    "fee": -0.00000141,
    "confirmations": 2,
    "blockhash": "00000006c87267d3c97c20311b6c820ebc07cd26554abdd6f084f396084c28a1",
    "blockheight": 221390,
    "blockindex": 408,
    "blocktime": 1731234338,
    "txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3",
    "wtxid": "095812e2b7aa3f62cf385afb102651499fffe5af842aba22a7b8930af561e379",
    "walletconflicts": [
    ],
    "mempoolconflicts": [
    ],
    "time": 1731234143,
    "timereceived": 1731234143,
    "bip125-replaceable": "no",
    "abandoned": false
  },
  {
    "address": "tb1qyts3hwlg0t3pjhmy5ts637e9aet5sxv6mqc0j9",
    "category": "send",
    "amount": -0.00300000,
    "label": "",
    "vout": 1,
    "fee": -0.00000141,
    "confirmations": 2,
    "blockhash": "00000006c87267d3c97c20311b6c820ebc07cd26554abdd6f084f396084c28a1",
    "blockheight": 221390,
    "blockindex": 404,
    "blocktime": 1731234338,
    "txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922",
    "wtxid": "30f01bc131db0fb330105444e30eb81c32b5242674f75332bd3bfcc311f1d8ce",
    "walletconflicts": [
    ],
    "mempoolconflicts": [
    ],
    "time": 1731234206,
    "timereceived": 1731234206,
    "bip125-replaceable": "no",
    "abandoned": false
  }
]
```

* UTXOのトランザクションIDをシェル変数に代入しておく

```bash
tx1="8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3"
tx2="d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922"
```

## 送金トランザクションの構成

### inputの構成

* UTX0
  * 8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3
  * 金額：0.005
  * アウトプットのインデックス（vout）：0
* UTX1
  * d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922
  * 金額：0.003
  * アウトプットのインデックス（vout）：1

### output の構成

* 送金金額：0.006
* 使用するUTXO
  * TXID：$tx1
  * vout：0
* 使用するUTX1
  * TXID：$tx2
  * vout：1
* 手数料：0.00003
* おつり：(0.005+0.003) - 0.006- 0.00003 =  0.00197

#### 送金先アドレスとおつり用アドレスの生成

* 送金先アドレス
  
```bash
bitcoin-core.cli getnewaddress

=>
tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9

# シェル変数への代入
bob3="tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9"
```

* おつり用アドレス
  
```bash
bitcoin-core.cli getnewaddress

=>
tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06

# シェル変数への代入
bob4="tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06"
```
### 未署名のトランザクションの作成

コマンドの文法

```
createrawtransaction <inputのJSON形式> <outputのJSON形式>
```

 * inputのJSON形式

```js
inputs                      (json array, required) The inputs
     [
       {                       (json object)
         "txid": "hex",        (string, required) The transaction id
         "vout": n,            (numeric, required) The output number
         "sequence": n,        (numeric, optional, default=depends on the value of the 'replaceable' and 'locktime' arguments) The sequence number
       },
       ...
     ]
```

* outputのJSON形式

```js
outputs                     (json array, required) The outputs specified as key-value pairs.
                               Each key may only appear once, i.e. there can only be one 'data' output, and no address may be duplicated.
                               At least one output of either type must be specified.
                               For compatibility reasons, a dictionary, which holds the key-value pairs directly, is also
                               accepted as second parameter.
     [
       {                       (json object)
         "address": amount,    (numeric or string, required) A key-value pair. The key (string) is the bitcoin address, the value (float or string) is the amount in BTC
         ...
       },
       {                       (json object)
         "data": "hex",        (string, required) A key-value pair. The key must be "data", the value is hex-encoded data
       },
       ...
     ]
```

作成するトランザクションの　inputのJSON形式の例

```js
'[{"txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3", "vout": 0}, {"txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922", "vout": 1}]'
```

作成するトランザクションの　output　のJSON形式の例

```js
'[{"tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9": 0.006}, {"tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06": 0.00197}]'
```

### 未署名のトランザクションの作成

```bash
bitcoin-core.cli createrawtransaction  '[{"txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3", "vout": 0}, {"txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922", "vout": 1}]' '[{"tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9": 0.006}, {"tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06": 0.00197}]'

=>
0200000002a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f300000000
```

### 作成した未署名トランザクションの確認

```bash
bitcoin-core.cli decoderawtransaction 0200000002a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f300000000

=>
{
  "txid": "42386e45b82c2eb4622a68e3cb7575be85075a5628f1f3752671291333ec53f2",
  "hash": "42386e45b82c2eb4622a68e3cb7575be85075a5628f1f3752671291333ec53f2",
  "version": 2,
  "size": 154,
  "vsize": 154,
  "weight": 616,
  "locktime": 0,
  "vin": [
    {
      "txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "sequence": 4294967293
    },
    {
      "txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922",
      "vout": 1,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "sequence": 4294967293
    }
  ],
  "vout": [
    {
      "value": 0.00600000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 061c17b8d7dd3b236081d5ac91566228212aaea9",
        "desc": "addr(tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9)#hgu7xlrq",
        "hex": "0014061c17b8d7dd3b236081d5ac91566228212aaea9",
        "address": "tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00197000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 a3f93f333b49a7011767f95ae7107cdb7df0a1f3",
        "desc": "addr(tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06)#wk9ydzam",
        "hex": "0014a3f93f333b49a7011767f95ae7107cdb7df0a1f3",
        "address": "tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}

```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

コマンドの文法

```
signrawtransactionwithwallet <未署名トランザクションの16進数形式>
```
結果

```
{                             (json object)
  "hex" : "hex",              (string) The hex-encoded raw transaction with signature(s)
  "complete" : true|false,    (boolean) If the transaction has a complete set of signatures
  "errors" : [                (json array, optional) Script verification errors (if there are any)
    {                         (json object)
      "txid" : "hex",         (string) The hash of the referenced, previous transaction
      "vout" : n,             (numeric) The index of the output to spent and used as input
      "scriptSig" : "hex",    (string) The hex-encoded signature script
      "sequence" : n,         (numeric) Script sequence number
      "error" : "str"         (string) Verification or signing error related to the input
    },
    ...
  ]
}
```

実行例

```bash
bitcoin-core.cli signrawtransactionwithwallet 0200000002a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f300000000

=>
{
  "hex": "03000000000102a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f302473044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c42523532012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae8140247304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a7012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae81400000000",
  "complete": true
}
```

### hex 部分をJSON形式でデコードしてみる

```bash
# 実行例
bitcoin-core.cli decoderawtransaction  03000000000102a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f302473044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c42523532012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae8140247304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a7012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae81400000000

=>
{
  "txid": "466fbc54e6a952eca93bc3073acdfe697b66bb1a124dc69221802c419814a2b5",
  "hash": "9d35f4703918b734234ccd11453242a9d43953d58d91c92ddc9c750202784eaa",
  "version": 3,
  "size": 370,
  "vsize": 208,
  "weight": 832,
  "locktime": 0,
  "vin": [
    {
      "txid": "8c8d8f926b2a59dd33a44e3d79ce534a03378cc768f5e0f13ade52786ed82da3",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "3044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c4252353201",
        "02bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae814"
      ],
      "sequence": 4294967293
    },
    {
      "txid": "d450b05b8ecc003d20815760b18872ea26f6f531ae70baaf8f30db818f108922",
      "vout": 1,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a701",
        "02bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae814"
      ],
      "sequence": 4294967293
    }
  ],
  "vout": [
    {
      "value": 0.00600000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 061c17b8d7dd3b236081d5ac91566228212aaea9",
        "desc": "addr(tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9)#hgu7xlrq",
        "hex": "0014061c17b8d7dd3b236081d5ac91566228212aaea9",
        "address": "tb1qqcwp0wxhm5ajxcyp6kkfz4nz9qsj4t4f2jtee9",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00197000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 a3f93f333b49a7011767f95ae7107cdb7df0a1f3",
        "desc": "addr(tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06)#wk9ydzam",
        "hex": "0014a3f93f333b49a7011767f95ae7107cdb7df0a1f3",
        "address": "tb1q50un7vemfxnsz9m8l9dwwyrumd7lpg0nc84n06",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}
```

"vin" に "txinwitness" という 域が存在していることを確 してください。

## トランザクションのブロードキャスト

コマンドの文法

```
sendrawtransaction <16進数形式のトランザクション>
```

結果

```
hex string The transaction hash in hex
```

実行例

```bash
bitcoin-core.cli sendrawtransaction 03000000000102a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f302473044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c42523532012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae8140247304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a7012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae81400000000

=>
466fbc54e6a952eca93bc3073acdfe697b66bb1a124dc69221802c419814a2b5
```

## トランザクションの検証

トランザクションがブロックに格納されてしまうと失敗します。
トランザクションをブロードキャストする前にリレーするノードのメモリプールでのトランザクションの検証しておくとよいでしょう

コマンドの文法

```
testmempoolaccept <JSON形式 '["16進数形式のトランザクション"]'>
```

結果

```json
[                               (json array) The result of the mempool acceptance test for each raw transaction in the input array.
                                Length is exactly one for now.
  {                             (json object)
    "txid" : "hex",             (string) The transaction hash in hex
    "allowed" : true|false,     (boolean) If the mempool allows this tx to be inserted
    "vsize" : n,                (numeric) Virtual transaction size as defined in BIP 141. This is different from actual serialized size for witness transactions as witness data is discounted (only present when 'allowed' is true)
    "fees" : {                  (json object) Transaction fees (only present if 'allowed' is true)
      "base" : n                (numeric) transaction fee in BTC
    },
    "reject-reason" : "str"     (string) Rejection string (only present when 'allowed' is false)
  },
  ...
]
```

実行例

```bash
bitcoin-core.cli testmempoolaccept  '["03000000000102a32dd86e7852de3af1e0f568c78c37034a53ce793d4ea433dd592a6b928f8d8c0000000000fdffffff2289108f81db308fafba70ae31f5f626ea7288b1605781203d00cc8e5bb050d40100000000fdffffff02c027090000000000160014061c17b8d7dd3b236081d5ac91566228212aaea98801030000000000160014a3f93f333b49a7011767f95ae7107cdb7df0a1f302473044022007d176823e533d5136327e3b82403d4f7fae168e8c4aa7996a40d17abb335be702204eae934155aa5645f665e8dbace110556ceca3f88a6014b8dbf4e41c42523532012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae8140247304402206d8b3701638a1603ebd84f2b8db4759f766321525f01e33072a4415bcf1e475d0220778ed847033f8aa514e400c54b6dd05db6491021141eea40c444787d8a4241a7012102bd020e2d941d158bccbae12565d951e144ef3ea49f048a1db168818446fae81400000000"]'

=>
[
  {
    "txid": "466fbc54e6a952eca93bc3073acdfe697b66bb1a124dc69221802c419814a2b5",
    "wtxid": "9d35f4703918b734234ccd11453242a9d43953d58d91c92ddc9c750202784eaa",
    "allowed": false,
    "reject-reason": "txn-already-in-mempool"
  }
]
```

### メモリプール内のtxidを確認する

コマンドの文法

```
getrawmempool
```

結果

```json
[           (json array)
  "hex",    (string) The transaction id
  ...
]
```

実行例

```bash
bitcoin-core.cli getrawmempool

=>
[
  "7cc3a14461355f012be7979ef5e7cbdda509790e2bba3826c4f0b13ab5be76a2",
  "eeadde892ada87f837f7f9160d25a6d61b17ee5b10a263f551feb89c69423613",
  "f1ee23e13b950ef03877a7c6dfdcf60348e98e2362e2c481334e03d6eeafa4fa",
  "c51f714f39b0941b5fbd24d66158616517499b99c52fe4236dcd168003bddff7",
  "43b8e90d25c03e115b43bfcf38c323a79be8ef0990b66196a28004adf8225ef6",
  "701f87223cfa3394801d7d8984bb5d651b48bfbf572af746d1cf8ff07ec515f5",
  "64d3d4ddbca3fd70df465136cf9241ef1c10df199db02d27b38ddf53086b08e8",
  "428590866563fc57d15d43a16442876031ed8a96495f71cfbe2dccec721276e0",
  "77a84ba3eb2010e3d8548a048ce1d050b14e0a41afac04ce720734fb3d121fdf",
  "2b7dc21a27133380ddc4d0d86d5490d52c2668b0851962b171e9d503d3fbbec6",
  "711e0445bff0d9a41d439ec2c88eb3e473ef4968e607882809485bfee0519cc3",
  "9844b12bbea871d9a82242fe7a66dd8c1ddada0c74d77b290b8aeb8d6c8158ba",
  "9d90e9ca270c317b23add12239f770ef47d55a5680daf148f2645e92192a11b6",
  "bfc640cc09840c85044c3692a6956a13b297fcaad68d22f5c1e9d34945a726b4",
  "1728d595c49e3ac479a317dc665b63e7e15f761cfeb6e3c7f22cf140cebe81a3",
  "448806b9e9409a5b51255158f03ff19ab0897cfa58ddc4d308daff86ebeccba1",
  "e96ecc836ea1fb0c788b0216ee9455946f688fbd0c9b24b8808facce32c20392",
  "af50f32472b2d9b12773a6d29a9ff861d93d15d1d6f9c18325dd0c6e6012a18d",
  "d19374e190b2908295674cdf4acc16cdd679e347b9f42338f78a19316bc3a687",
  "9c8e62f6703986c5e0e5ef93e54c562a8f88183d8e927f948ff66f552c3eba7c",
  "f782f6b6287e26acaf7b5e501295daf5b2271d73921e36588e45ba040381ab7c",
  "de1213fe625d360853ba8af0f8b5caac3111e3182c1147c8ee93652af1cdf775",
  "6be18b670305ec4ac592a65ef52eb39f9e93fe96033e70157a49b41057714f74",
  "e583fbccd508c110650c4c8062cfc9e281481ccd5a4d7e6d7dfd724e9857295e",
  "af0841defc307e72aa4b6ffd03cd4c0c0465cbe3339ab7237f997a232479d55c",
  "9e0393211e409f9980730d70a4910f1300cba8e1973436020cebed07250b245b",
  "a8d3430ea3cafdb169e211d2113517d5477f549d7f5b5b2a15a2cad9896c0e5b",
  "b3ba1de977c002dc23162894f5bd0b2a09292630a448fb41f6860705a455ba4f",
  "fcee10370271a6f4864d4331481fbfe71ce5a7102c94af3fb0eaeabd00332649",
  "9e72f22f04921cccc08fb4df12398ef2511d384d5400a0ba099c516c1a61e841",
...

]
```

## ブロックチェーン

### ブロック⾼

コマンドの文法

```
getblockcount
```

実行例

```bash
bitcoin-core.cli getblockcount

=>
221413
```

### ブロックハッシュ

コマンドの文法

```
getblockhash <ブロック⾼>
```

実行例

```bash
bitcoin-core.cli getblockhash 45140

=>
00000114208c2281068d15a10b266dd49a4d723c797101a3f5decef1f6c5977e

bitcoin-core.cli getblockhash 0

=>
00000008819873e925422c1ff0f99f7cc9bbb232af63a077a480a3633bee1ef6

bitcoin-core.cli getblockhash 1000
=>
0000010ebfa3c6193793701c198392e21bdb8bc9fb2032f0d74a628d36e9a75e

bitcoin-core.cli getblockhash 221413
=>
0000009c524f8e7ef4bb2d7ec67bc1d9447ec7645d27aea1f58913a5d116a2bf
```

どのブロックハッシュも複数の0 で始まっていることに注意してください。
これがマイニングの計算結果です

### ブロックヘッダ

コマンドの文法

```
getblockheader <ブロックハッシュ>
```

結果

```json
{                                 (json object)
  "hash" : "hex",                 (string) the block hash (same as provided)
  "confirmations" : n,            (numeric) The number of confirmations, or -1 if the block is not on the main chain
  "height" : n,                   (numeric) The block height or index
  "version" : n,                  (numeric) The block version
  "versionHex" : "hex",           (string) The block version formatted in hexadecimal
  "merkleroot" : "hex",           (string) The merkle root
  "time" : xxx,                   (numeric) The block time expressed in UNIX epoch time
  "mediantime" : xxx,             (numeric) The median block time expressed in UNIX epoch time
  "nonce" : n,                    (numeric) The nonce
  "bits" : "hex",                 (string) The bits
  "difficulty" : n,               (numeric) The difficulty
  "chainwork" : "hex",            (string) Expected number of hashes required to produce the current chain
  "nTx" : n,                      (numeric) The number of transactions in the block
  "previousblockhash" : "hex",    (string) The hash of the previous block
  "nextblockhash" : "hex"         (string) The hash of the next block
}
```

実行例

```bash
# (ブロック高1000)
bitcoin-core.cli getblockheader 0000010ebfa3c6193793701c198392e21bdb8bc9fb2032f0d74a628d36e9a75e

{
  "hash": "0000010ebfa3c6193793701c198392e21bdb8bc9fb2032f0d74a628d36e9a75e",
  "confirmations": 44189,
  "height": 1000,
  "version": 536870912,
  "versionHex": "20000000",
  "merkleroot": "436bcf79ac698ba221f2f67ed7c9e42c5ddb6fb8b5f6f6322491f45bd08d8c97",
  "time": 1599132457,
  "mediantime": 1599131361,
  "nonce": 190116,
  "bits": "1e0377ae",
  "difficulty": 0.001126515290698186,
  "chainwork": "0000000000000000000000000000000000000000000000000000000120ae4234",
  "nTx": 1,
  "previousblockhash": "000002adbe0fa5467506fdde47518fe75d65dc1eac5b150e00856f1706850627",
  "nextblockhash": "00000203b537056a20c93d7b43cff2dffb977e96267766f458acc66b581e5d2c"
}

# 実行例 (ブロック高1001)
bitcoin-core.cli getblockheader 00000203b537056a20c93d7b43cff2dffb977e96267766f458acc66b581e5d2c

{
  "hash": "00000203b537056a20c93d7b43cff2dffb977e96267766f458acc66b581e5d2c",
  "confirmations": 44188,
  "height": 1001,
  "version": 536870912,
  "versionHex": "20000000",
  "merkleroot": "96d7fad27e531a099ed0c813e2e7f0e00e6e0484ee21f89d2657befdcaf3e9d4",
  "time": 1599132465,
  "mediantime": 1599131457,
  "nonce": 8821577,
  "bits": "1e0377ae",
  "difficulty": 0.001126515290698186,
  "chainwork": "0000000000000000000000000000000000000000000000000000000120f81648",
  "nTx": 1,
  "previousblockhash": "0000010ebfa3c6193793701c198392e21bdb8bc9fb2032f0d74a628d36e9a75e",
  "nextblockhash": "000002e1d2d6a4992d5aae0afa452d8ffeb3cc4488c220560fa06234b8fb13e8"
}
```

 "previousblockhash" の値が，ブロック高1000のブロックハッシュと一致していることを確認してください。

### ブロック全体の情報

コマンドの文法

```
getblock <ブロックハッシュ>
```

結果

```
{                                 (json object)
  "hash" : "hex",                 (string) the block hash (same as provided)
  "confirmations" : n,            (numeric) The number of confirmations, or -1 if the block is not on the main chain
  "size" : n,                     (numeric) The block size
  "strippedsize" : n,             (numeric) The block size excluding witness data
  "weight" : n,                   (numeric) The block weight as defined in BIP 141
  "height" : n,                   (numeric) The block height or index
  "version" : n,                  (numeric) The block version
  "versionHex" : "hex",           (string) The block version formatted in hexadecimal
  "merkleroot" : "hex",           (string) The merkle root
  "tx" : [                        (json array) The transaction ids
    "hex",                        (string) The transaction id
    ...
  ],
  "time" : xxx,                   (numeric) The block time expressed in UNIX epoch time
  "mediantime" : xxx,             (numeric) The median block time expressed in UNIX epoch time
  "nonce" : n,                    (numeric) The nonce
  "bits" : "hex",                 (string) The bits
  "difficulty" : n,               (numeric) The difficulty
  "chainwork" : "hex",            (string) Expected number of hashes required to produce the chain up to this block (in hex)
  "nTx" : n,                      (numeric) The number of transactions in the block
  "previousblockhash" : "hex",    (string) The hash of the previous block
  "nextblockhash" : "hex"         (string) The hash of the next block
}
```

実行例

```bash
bitcoin-core.cli getblock 00000114208c2281068d15a10b266dd49a4d723c797101a3f5decef1f6c5977e

{
  "hash": "00000114208c2281068d15a10b266dd49a4d723c797101a3f5decef1f6c5977e",
  "confirmations": 48,
  "strippedsize": 709,
  "size": 973,
  "weight": 3100,
  "height": 45140,
  "version": 536870912,
  "versionHex": "20000000",
  "merkleroot": "4b23ac44bf5c4b37f990f5e02e5fb0c4f13a7e3f70b3e484f46866aa3b47f77c",
  "tx": [
    "747b2a9e6cb18b8fbabe3dc335b4d325e5cf14f2d163f170342583a22ebfd002",
    "72e1e1fab2dac6b602f6efe93ce244c8cd49f7c39643015db51987e630a70424",
    "0e5c4e88960afb07ae0fa0a349c55500ebf0929e4e22e7e901007def2285c944",
    "4e11d01a69fba6637485b08ac933b0fa511b4407092bb66a66fc58f49f4c0d07",
    "83540e22fdbe52b0ac9f764b1877c55ee082a90a14536526f498ef83b5b286f4"
  ],
  "time": 1625414501,
  "mediantime": 1625411439,
  "nonce": 16011182,
  "bits": "1e015b0e",
  "difficulty": 0.002881346304279315,
  "chainwork": "0000000000000000000000000000000000000000000000000000007f68730b24",
  "nTx": 5,
  "previousblockhash": "000000e114a7a3043c9e19fcc0fa1ce8a445085cb8f3e83759d7ce7214155e33",
  "nextblockhash": "00000023d235a8e8911b6bfc084a0be9e86cf4b030e2ba3a127efa642b5d7bf9"
}
```

## プルーフ・オブ・ワークによるマイニングの実行

ブロックのマイニングは次のコマンドで実行できますが，signet はマイニングの成功だけではブロック生成の権限がないので失敗してしまいます。実験するなら regtest モードでノードを起動しましょう。

### bitcoind を regtest で再起動

```bash
# bitcoind を停止
bitcoin-core.cli stop
```

(snap の場合，cd ~/snap/bitcoin-core/common/.bitcoin/)
regtest用の　bitcoin.conf を作成（signetの設定ファイルも別名で保管しておく）

#### bitcoin.conf の修正

```
regtest=1

...
```

```
# bitcoind を regtestモードで再起動
bitcoin-core.daemon &
```

### マイニングしてみる

regtestモードで実際にマイニングしてみます

コマンドの文法

```
generatetoaddress <マイングするブロック数> <ビットコインアドレス> <最大試行回数>
```

結果

```
[           (json array) hashes of blocks generated
  "hex",    (string) blockhash
  ...
]
```

### regtestモードでの ワレットの作成

```bash
## regtestネットワークでのワレット作成
bitcoin-core.cli createwallet miner

## アドレス生成


```bash
bitcoin-core.cli getnewaddress

=>
bcrt1qk7scjj5kjt9l3cqv8hl3v92xrp8dvdcrafy8nm
```
### マイニング 101ブロック

bitcoin では，マイニング成功後に 101 ブロックの後続ブロックが接続されると，コインベースの資金が確定し，マイナー（指定したアドレス）のものになる．


```bash
bitcoin-core.cli generatetoaddress 101 bcrt1qk7scjj5kjt9l3cqv8hl3v92xrp8dvdcrafy8nm 10000000
```

```js
[
  "480d8422ba7c51047424802fbaa817bc4bf187960f99517b2ba2bd1ee56cd928",
  "166fe030cf46378f27649251b32560670485e3502dba8dc21d3e79c7486dd589",
  "1fab94c43db18619b600c82fde57428a474a5d16b464d30b1dc7a3a8d06883e1",
  "6b9d04672d49fd6744185077c4047d74899b402a6312baf147ace0eb98e7aed9",
  "7d7e9091b6258f5f299a5b1e79016a48b985a6baec0c30fe2dc211b3704e22d4",
  "7325f79f170d7e3c8c40f7cc80bee1870523f94344220556d526a08bee7571f0",
  "1c4a96416ae49da9ab7df6229fad3c821e483ae0c952d04353e4eaecc9d249e1",
  "0691b1da1a4399722d25b35289876e7ef7517f432ea0417fe4e14fe9ce12a279",
  "07bb60a379cb99c89147a4924ded9d349aa1f9b5290cb6aa41139e2fb016cf19",
  "116c173e2017b40d1c3c3de6729162eea2064a9221f06a9ebc2f7a21cfca4dba",
  "449569088c13620501a5ac494cee94a9a98a4042b755a336cae4ff631ce51455",
  "5cc0af37d31a8583c316f0244999b7009f2b1dfe9bd0790273d06abda1e70f75",
  "110bdf99e8be6deb549f313f108e53fb7c669df3609cf89661c8ab4317fdd95b",
  "78da9250c08550ebc520b2102684811b567dd32ef2afdc477b99d380745c29f6",
  "781781bba9332121fd6c6faa6423158cda141746ccc31923a1bf84f752293b62",
  "31d7037c44b4115f2d155dc9f2c2ca43d94641a1384d28bb6bddfaf2778cbb1c",
  "3be318d0f04dbf8a86cb504688fb9131cff869b46463dce5471b034f12dfb019",
  "5e9fcad347788d47763f282c738b4c98a8a5fe55c34ea131f613d94ea970ae24",
  "1150e332aef8db38a2f68776bb61931a9420a3939815db5e33c2eebab0bee167",
  "79fc78c1cddcf36f23081af99e4537fb43c8de5bb6922207fc7a73ebbda7b1f4",
  "57b4efb1228270c4758011d9d00e6320773d4a0845c79c2f5783fbc0de247b0f",
  "269077d5802057b18a08e65cbc889561cb5cd314f8e50afd2f6fa1738c34de42",
  "2356adafe8e49e12cf282eb3c3afe359ebe86e4dde66370e83427f0d7ab39fd6",
  "2141c3c766cc160e8fa8c28a7b7311f0b53d8b84cf9df0d2d617078ba646c020",
  "668c7d810fd54883447f0d4050a3a0c69bb85be08d873476ebcb78ffb289954a",
  "057c4d42e4e278cb4c04d499ed9658b8e47524013150d3df245beb4bbddf3535",
  "2ae8f9d56d64aecc21198f2144021cb578eeadd0dfcd82d7906f0cf685c5f249",
  "32ed62855a1a128f4673c36c0d564bba879d0d9458a4ca07b8dec7bce3716523",
  "4de46c86ccb4a12fcb6cbcdaa9da3c2ebff912430815cc8f7659009c8d267fd0",
  "5a0b851a67265460498b57f68d3f2a74b1fb9eb23e768c7c5ce274c706e3a2ad",
  "6700a020026fb62437d3f279ff2e1d7eb41d7602cda2fe391ab0019c6016da55",
  "29b98cc2814139ac46de32a3c231677f5c507f822ca448956cb041d7ab951db6",
  "37b9df77f7c9733311df94f0935e2e07847122e15b75342e96e8612b2e1597a3",
  "7a560d58d8f0e7089cebdb9f071c97eb138392dfebf82c3999d369a0f89ea87d",
  "645f10295f699b0a499924bdfd30a10ac9aaf4859e631f6e1f54a53cd357d11a",
  "10fa7bc3af6d6e5af9ccbe1166f500538a913cf40e0462a6444db2c7e6888b3e",
  "13beeb368aa2d0a29a73f0bfb55e92c84214b036b5a052b0cff35cb8ec307a4c",
  "6f73b1446fd0119a0b6b1c13480bd03d8ee6bd5f7834a6058e8b4ca566627fac",
  "206d8634f0f361474f79ce4c352e68badeaa2a9bc04d6285c1a5b9a99091a937",
  "1a9ae87561b5a731af7d090088743e5af1459aa1ea302870688da889abbe8f0c",
  "4a6eb0fff7d887c5d0abb52a7bf2ae0414fb222aa12dca6931c0c970359ca0cf",
  "1db6c9df9356eb0fedf6b7bc6d46a840a63ba7bfc72d0ea1557f3e26e50c1461",
  "6d5125fdff9fbf4e074e6501e19b6b969de138b53b27d11bf659dfdb69a1e6b0",
  "528e509c768f7a9bf2adf238a6d8fb32f2f61fc478e32b296c6fd97561e43f46",
  "1260728f3a333e1c684ce9924280a97f29b99b51c3c3cbe7dd3a30f4df1c4824",
  "11644cc7907073814586d8baf8b43ebdd32bdc7650f6d5e9d352c8ef47d2259f",
  "1b22bac44794bc7db509dcd2df77b339107edbf319c6e54035c9dbf598b578fa",
  "1ebe8224cf7ebc695e3b92a0401e4848d13b54c8991e2203a4a447c459f17699",
  "2177dce23e210f584e005501dd1b36d25ec5d188399f05cf2113bede1a25d339",
  "50a9c9b8ea1f48a722207110e287b19b1351a6b44dff0db075044853e3ccc03a",
  "6406f45010c627774611787a0ef1e1243b2bd94f13f415d20bcbeeee8927ba19",
  "20d13c92cc91d3d9ddfc359f08ed759474364b367e861f44e2b3f977e52d7806",
  "094bec495fd7d4311643cd434e26fb7dfeebfdf17ea680ace63e49e8ba2079a7",
  "6ee7cc799e693f31a00e90f22f88a0f1408c07aea065668a8b42aa57a5123bc6",
  "1dc7aa38fd2fbf97d7dcb570900768afb20375988ad0c6e9a6b1d60174096b24",
  "294d59accd00609c51e8efa640c01b58d446f4358439f124845e684b8cb22dc6",
  "441638cde32567a0aa7031741429f2d56ffe03a871449596c57e51460e1b57cc",
  "69e53e7bd3d7ac16e5cb9e2c6ef68f319d612509084f4ad73f1d04443550cd4c",
  "697220e576dc698b477236d24c0001e751e960786eb8be45bb2febdcd44c729a",
  "5f95c6a6eba9bc309f45a51eb685a2f5826b41dba0f9bebbb19fdab52523437f",
  "2ba208fa54a7461daac1154d1c584348a0534577256fb93fab028e29f7be0632",
  "36624e5227ff5dec1373206b9693b56ea3743fb9ae33f8aa01aeb8cf08af30ba",
  "4fafc247a3970e53875453ee3f1418ac2b652702d804ba7c91b20733f290630f",
  "2ce51b53b38597c3bca3000ad00ce8dbb6e7fa429e50870b137ea1ba8fae34e8",
  "1f730a2fd9e89d745659fa53e724f55458d301b121f1ac17e0308ae079e91a76",
  "07909d746b1b6097b8b6b57af1dcd5470fd611ea86e8e2948071a695d7a5ca29",
  "2a8e7fe7df87a406aa5eb97aec876cb037e9ac60a6542df1e797cefd366e98cc",
  "5bd79e2d6f38c951f8c8b7d608ea2b56c541239d7b7141f2b35066ff3ef2635c",
  "1f97c435757f73ab5614542df315b8d33cebd8766b6209159974798e7679dc1d",
  "003e740439085f14863cb42460d7dcb08a04c4d7e8753985d6772d15b247193e",
  "045a10c4db6cc7042ade836f79a32b4e35cb8faf71ce60c7bd4e902979bac879",
  "50a325d4da5a8b12c786657515b0d1b26d36319b0bc719049775556dccfb5d2f",
  "753dd6e5a1cb8869d98443eb2dd3c6ed352565dc187bd4c20b5d0c27510be8f8",
  "2cad7cbcfd6063ff6b0e114dc8e076ef9d2af50f995bca6e8f2442474399caa6",
  "65e57a9a1c3c9ba53591dcecf6ad5aa45c1344efd699e48815a1dd510ccfecc2",
  "2bbab5c565e56b093cd527b4e3c15ea6eee99dd9cb95dcc6bb929e851bac79ab",
  "27a40af633bc3c3ea73e3a34b364d04c500a3d7bd3202607697c4d07b29735af",
  "7c2590b4236d60cff67a5128a9b4b0db73a2de764565274d2858f4011c0d772c",
  "2aaa505b7c3d14d8f87836e72d7f1208c07b52e0f4142b2db29cb69594c791e1",
  "4033db8404f283e4a026456daedc32c0f778a34f83ce166b898777f2b320ff1c",
  "4b6072e0178d3c735e7e224c12a0b6d1e319c51107a0400dca39c179aae651f2",
  "2666676428c2087207b2691d21bcb41439b26ace694d0fcda793feedeb6157b0",
  "3c9e16e7c08341909d250ff56efbef2ee662853af65ae1b3c319a7dd984cdb60",
  "79a6f32143357612139f68f8798fefe2b097ee121e65bcf00cf181fa27e3a425",
  "5df096824361b31c4fa14e837fbfaf90d8f3e83c76b2b63773807dba95e5ff36",
  "4bc77ebe46637913269860e90fb08d3d909b5eb3c5c14c7ad824c4c69af37419",
  "7c770a321968bc19798d9846d51170d53a231eba741e2e319b1c6bfe67ddee72",
  "68a4eff5112606457880b2284edd7a9b081467b8862be1b99264453e1809bd6e",
  "00524089052fd11af892ae8cebfcb9ea657488a6dd1558d006d29a9362d2a90d",
  "49170574bc332aa79b48c68c3208f9fdfd7f8199b4f2130a5733ab529b9646c0",
  "0522a00834086eb9c425f07f4dc6d682233814e9a2abfd630a46844f23f73e74",
  "488b851353a509e3a639ff3d368a7bdd95caeb8bec37fec20e159174b235927c",
  "1e67d0925391f59a7293f855f24c42ca1113cb3ac29d998e28a8229996e12dc9",
  "7546847f2139de7e2a3dfe000bf717ef3132e0c336e69389f15e57a5a1136aed",
  "5f1b582fed45bc70b4899d586d3e1a66d8ce80ecfc7fb73cbd51c6b7151a714d",
  "74a17b82b2fc99fc2c7292abc92ce2d3faff7e627619c2f4c3ce72a46033b162",
  "705103075f0821021522e6c21427b5619a7451c780080dfa48e2784124349a26",
  "48c1dd852181462227551e17c36024291cef088580e76ae18b85628cfc9d6a72",
  "5f8e404b25f2f40f83b011c0481fd004756c09d3e12a4864f25240f138c49267",
  "6ca86380318ddeef1f31c43f82a252ff91bb37a5edaf8d30c57e76692c49bfd2",
  "79afcb1da06ed31b49fa7ebaf00ee37f3647af559a2b3089940772db13f988e1"
]
```

### マイニング結果の確認

```bash
# 自分の所持金を確認
bitcoin-core.cli getbalance

50.00000000
```

### signetに環境を戻す

bitcoind を再起動


```bash
# bitcoind を停止
bitcoin-core.cli stop
```

signet用の　bitcoin.conf に戻す（別名で保管から復元）
(snap の場合，cd ~/snap/bitcoin-core/common/.bitcoin/)

bitcoin.conf を修正

```bash
signet=1

...
```

```bash
# bitcoind を regtestモードで再起動
bitcoin-core.daemon &
```


## シェルスクリプトの利用

bitcoinには直接関係ありませんが，演習を行う上でシェルスクリプトを知っていると便利で間違えにくくなります．

この後の演習では シェルスクリプトを利用するので，簡単に解説しておきます．

### シェルスクリプトとは

Linux のコマンド操作を支援するためのプログラミング言語処理系です．

人間がコマンドを入力してコンピュータを操作することをプログラムによって実行できるようになります．

### シェル変数への代入と評価

#### 代入演算子 '=' 

'=' 演算子を使って文字列を変数に代入する．

```bash
MyAddr="tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh"
```

#### 評価演算子 '$'

評価演算子 '$' によって変数を評価して代入されている文字列を取り出す

```bash
$MyAddr

=>
tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh: コマンドが見つかりません
```

'$' 演算子で出力された文字列はシェルによってさらにコマンドとして評価されます．

ここでは，アドレスの文字列がコマンドと解釈されるので「コマンドが見つかりません」というエラーになります．

date コマンドの場合
```bash
date

=>
2024年  6月 12日 水曜日 19:39:22 JST

D=date

$D
2024年 6月12日 水曜日 19時37分29秒 JST
```

#### ' " （シングルクォートとダブルクォート）

' " （シングルクォートとダブルクォート）は基本的に評価を停止し，囲まれた内容を文字列として扱うことを意味します．

シェルスクリプトでは，' （シングルクオート）や "（ダブルクォート）で囲まなくても文字列として扱われますが，文字列に空白が含まれる場合はクォーテーションで囲む必要があります．

```bash
Wallets='bitcoin-core.cli -rpcwallet=alice listwallets'

$Wallets

=>
[
  "alice"
]

```

* echo コマンド

python などのプログラミング言語での print文のように標準出力に文字列を出力するコマンドです．

```bash
echo $MyAddr

=>
tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh
```

空白を含む文字列の場合は クォーテーションをつけます

```bash
echo 'bitcoin-core.cli listwallets'

=>
bitcoin-core.cli -rpcwallet=alice listwallets

echo "bitcoin-core.cli -rpcwallet=alice listwallets"

=>
bitcoin-core.cli -rpcwallet=alice listwallets
```

" （ダブルクォート）の文字列の中で変数を評価することができます．

```bash
echo "bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr"

=>
bitcoin-core.cli -rpcwallet=alice getaddressinfo tb1qdu6n0yhtm7lpyyhev9vrw7mfg9sd80rxmv4mmh
```

'（シングルクォート）の文字列の中では変数は評価されません

```bash
echo 'bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr'

=>
bitcoin-core.cli -rpcwallet=alice getaddressinfo $MyAddr
```

* 特殊文字とエスケープ

以下の文字は特殊文字なので，そのまま記述しても文字としては扱われません

```
* ? [ ' " ` \ $ ; & ( ) | ~ < > # % = スペース タブ 改行
```

特殊文字を文字として扱いたい場合は，その前に \（バックスラッシュ）をつけます

```bash
H="\"hello\""

=>
echo $H
"hello"
```

#### ` (バックスラッシュ) と $() によるコマンド置換

` (バックスラッシュ) は，クオートの反対で，囲まれた内容をシェルの処理系で評価することを意味します．

$() は ` (バックスラッシュ)の新しい表記方法で，基本的に同じことを意味しますが， \（バックスラッシュ）による特殊文字のエスケープの処理が少し異なっています．

コマンドの中にコマンドの実行結果を埋め込むことができます．

```bash
echo date
=>
date

echo `date`
=>
2024年 6月 13日 木曜日 00:55:18 JST

echo $(date)
=>
2024年 6月 13日 木曜日 00:55:28 JST
```

\（バックスラッシュ）による特殊文字のエスケープの処理の相違点

```bash
echo `echo '\\'`
=>
\

echo $(echo '\\')
=>
\\

```

