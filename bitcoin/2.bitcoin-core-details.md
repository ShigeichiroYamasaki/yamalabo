# 2. bitcoin core の詳細

2024/03/15  更新 Shigeichiro Yamasaki

## ビットコイン開発コミュニティとBIP

* [メーリングリスト bitcoin-dev](https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev)
* [Slack: https://bitcoincore.slack.com/](https://bitcoincore.slack.com/)
* [BIP](https://github.com/bitcoin/bips)

## 一連の流れで演習します

```

(UTXOの資金)-->TX1-+-->0.00028BTC -->TX2(P2PK)  --> 0.00018BTC-+
                  +-->0.0002BTC  -->TX3(P2PKH) --> 0.00018BTC-+
                  +-->0.0002BTC  -->TX4(P2SH)  --> 0.00018BTC-+
                  +-->0.0002BTC  -->TX5(P2WPKH)--> 0.00018BTC-+
                  +-->0.0002BTC  -->TX6(P2WSH) --> 0.00018BTC-+--> TX7 -->
                  +-->おつり
```

0. 事前にsignetのfaucet から0.002 BTC以上のビットコインを得ておきます。

1. faucetから得たUTXOをinputとして6個のoutputを持つトランザクション (TX1) を作成し，署名して，ブロードキャストする

2. 5個のUTXOを利用して，P2PK, P2PKH, P2SH, P2WPKH, P2WSH の5つのタイプのoutputを持つ5個のトランザクション(TX2 ~ TX6) を作成し，それぞれ署名して，ブロードキャストする

    ★ P2PK のoutput を持つトランザクションの作成はバイナリ形式で作成する必要があります

3. 5個のタイプの異なるUTXOをinputとするトランザクション (TX7) を作成する

    ★ P2SH, P2WSH のUTXOをワレットに認識させる必要があります。

4. トランザクション(TX7)に署名してブロードキャスト

## トランザクションタイプと基本構造

### faucetから得たUTXOをinputとして5個のoutputを持つトランザクションを作成し，署名して，ブロードキャストする

1. ビットコインアドレスを５つ生成する
2. 使用するUTXOを確認する
3. ５つのoutputを持つトランザクションを作成する
4. 作成したトランザクションに署名する
5. 署名したトランザクションをブロードキャストする

## ビットコインアドレスを５つ生成する

* ワレットが一つの場合は -rpcwallet=<filename> オプションは不要です
* 文法は，getnewaddress ( "label" "address_type" )
* address_type には，"legacy", "p2sh-segwit", "bech32", a"bech32m" があります．legacy (p2pkh), bech32 (p2wpkh) ．

★ 以下のアドレスは例です．それぞれ自分でアドレスを生成してください

```bash
bitcoin-core.cli  getnewaddress bob bech32
=>
tb1qr8nw62s3r0pgc5t6devcstmw3e2t3959m6tlly

bitcoin-core.cli  getnewaddress carol bech32
=>
tb1qy0z6vfy7q03hhzcmqcqjfj550av6q2crptcvnk

bitcoin-core.cli  getnewaddress david bech32
=>
tb1qthdplmvu3gwgr3qfwem4df9qhqhz2dw3gyl9ej

bitcoin-core.cli  getnewaddress eve bech32
=>
tb1q47pxy839d09nl0yfzmf43h8qaw376crujj7un6

bitcoin-core.cli  getnewaddress franc bech32
=>
tb1qwj3duktjj52jcj5089xgfkw5dlw4k9fn2xm729
```

### 生成したアドレスをメモしてください

この文書の例では以下のようになっていますが，実際には自分で生成したアドレスを利用します．

* bob: tb1qr8nw62s3r0pgc5t6devcstmw3e2t3959m6tlly
* carol: tb1qy0z6vfy7q03hhzcmqcqjfj550av6q2crptcvnk
* david: tb1qthdplmvu3gwgr3qfwem4df9qhqhz2dw3gyl9ej
* eve: tb1q47pxy839d09nl0yfzmf43h8qaw376crujj7un6
* franc: tb1qwj3duktjj52jcj5089xgfkw5dlw4k9fn2xm729


## 使用するUTXOを確認する

この例では、"amount": 0.0100000　を持つUTXOを利用しますが，以下では自分が所持している bitcoin の金額でトランザクションを作成してください．

使用する"txid" と "vout"と "amount" と "address" の値をメモしてください

```bash
bitcoin-core.cli  listunspent
=>
[
  {
    "txid": "a9782e5dcf0f5d39dfa5fd4d4df70c45b0d1fbf61f2f6a068f3a3e2deab57819",
    "vout": 1,
    "address": "tb1qgf02pn7fzaq0aknvq640j9gqc9td8p3cw47wj8",
    "label": "",
    "scriptPubKey": "0014425ea0cfc91740feda6c06aaf91500c156d38638",
    "amount": 0.01000000,
    "confirmations": 120,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([9c550be8/0'/0'/0']0228ae76be284ce77290c5b6cf984cdea75ddae69b726a212b551ce7eabc202898)#ucrzfac3",
    "parent_descs": [
    ],
    "safe": true
  }
]
```

### この例のUTXOの場合

この例では UTXO が一つしかないので，以下のようになります．
一般的には複数のUTXOがあります．ので，0.002 以上の資金を持つUTXOを選んでください．

* txid: a9782e5dcf0f5d39dfa5fd4d4df70c45b0d1fbf61f2f6a068f3a3e2deab57819
* vout: 1
* amount:  0.0100000
* address: tb1qgf02pn7fzaq0aknvq640j9gqc9td8p3cw47wj8

このアドレスは，UTXOを所有しているアドレスです．

## ５+1 個のoutputを持つトランザクションを作成する

* input として使用するUTXOの txid と vout
* output は、生成した5つのアドレスです
* ５つの送金先アドレスへの送金金額は，それぞれ 0.0002 とします．
* outputにはおつり用のアドレスがさらに一つ必要です．ここではUTXOの所有者にします．

### おつりの計算

ここではおつりは，0.00002 とします．

0.01 - (0.0002)*5 - 0.00002 =  0.00898


## トランザクションの作成

JSON形式で input と output を作成します．

実行結果は 16進数形式です．

```bash
bitcoin-core.cli  createrawtransaction  '[{"txid":"a9782e5dcf0f5d39dfa5fd4d4df70c45b0d1fbf61f2f6a068f3a3e2deab57819","vout":1}]' '[{"tb1qr8nw62s3r0pgc5t6devcstmw3e2t3959m6tlly":0.0002}, {"tb1qy0z6vfy7q03hhzcmqcqjfj550av6q2crptcvnk":0.0002},{"tb1qthdplmvu3gwgr3qfwem4df9qhqhz2dw3gyl9ej":0.0002},{"tb1q47pxy839d09nl0yfzmf43h8qaw376crujj7un6":0.0002},{"tb1qwj3duktjj52jcj5089xgfkw5dlw4k9fn2xm729":0.0002}, {"tb1qgf02pn7fzaq0aknvq640j9gqc9td8p3cw47wj8":0.00898}]'

=>
02000000011978b5ea2d3e3a8f066a2f1ff6fbd1b0450cf74d4dfda5df395d0fcf5d2e78a90100000000fdffffff06204e00000000000016001419e6ed2a111bc28c517a6e59882f6e8e54b89685204e00000000000016001423c5a6249e03e37b8b1b060124ca947f59a02b03204e0000000000001600145dda1fed9c8a1c81c409767756a4a0b82e2535d1204e000000000000160014af82621e256bcb3fbc8916d358dce0eba3ed607c204e00000000000016001474a2de597295152c4a8f394c84d9d46fdd5b1533d0b30d0000000000160014425ea0cfc91740feda6c06aaf91500c156d3863800000000
```

## 作成したトランザクションに署名する

```bash
bitcoin-core.cli  signrawtransactionwithwallet 02000000011978b5ea2d3e3a8f066a2f1ff6fbd1b0450cf74d4dfda5df395d0fcf5d2e78a90100000000fdffffff06204e00000000000016001419e6ed2a111bc28c517a6e59882f6e8e54b89685204e00000000000016001423c5a6249e03e37b8b1b060124ca947f59a02b03204e0000000000001600145dda1fed9c8a1c81c409767756a4a0b82e2535d1204e000000000000160014af82621e256bcb3fbc8916d358dce0eba3ed607c204e00000000000016001474a2de597295152c4a8f394c84d9d46fdd5b1533d0b30d0000000000160014425ea0cfc91740feda6c06aaf91500c156d3863800000000

=>
{
  "hex": "020000000001011978b5ea2d3e3a8f066a2f1ff6fbd1b0450cf74d4dfda5df395d0fcf5d2e78a90100000000fdffffff06204e00000000000016001419e6ed2a111bc28c517a6e59882f6e8e54b89685204e00000000000016001423c5a6249e03e37b8b1b060124ca947f59a02b03204e0000000000001600145dda1fed9c8a1c81c409767756a4a0b82e2535d1204e000000000000160014af82621e256bcb3fbc8916d358dce0eba3ed607c204e00000000000016001474a2de597295152c4a8f394c84d9d46fdd5b1533d0b30d0000000000160014425ea0cfc91740feda6c06aaf91500c156d3863802473044022009611056f2943b0fe3745c9eb4f9b29a0f4c4e12edd390b4c8eb54fa39a4568302205592df75fc5cbc5895b958c01e8430d14b820b9ed1f51b8ffef6f8b4b29edf1c01210228ae76be284ce77290c5b6cf984cdea75ddae69b726a212b551ce7eabc20289800000000",
  "complete": true
}

```

## 署名したトランザクションの内容の確認

```bash
bitcoin-core.cli  decoderawtransaction 020000000001011978b5ea2d3e3a8f066a2f1ff6fbd1b0450cf74d4dfda5df395d0fcf5d2e78a90100000000fdffffff06204e00000000000016001419e6ed2a111bc28c517a6e59882f6e8e54b89685204e00000000000016001423c5a6249e03e37b8b1b060124ca947f59a02b03204e0000000000001600145dda1fed9c8a1c81c409767756a4a0b82e2535d1204e000000000000160014af82621e256bcb3fbc8916d358dce0eba3ed607c204e00000000000016001474a2de597295152c4a8f394c84d9d46fdd5b1533d0b30d0000000000160014425ea0cfc91740feda6c06aaf91500c156d3863802473044022009611056f2943b0fe3745c9eb4f9b29a0f4c4e12edd390b4c8eb54fa39a4568302205592df75fc5cbc5895b958c01e8430d14b820b9ed1f51b8ffef6f8b4b29edf1c01210228ae76be284ce77290c5b6cf984cdea75ddae69b726a212b551ce7eabc20289800000000
=>
{
  "txid": "220dd7b0b29ef5c46659ea5ba4b0db2a99dcd6ae7e5c8062abbc72dd1343c98d",
  "hash": "b169f8c6330ad10ffd271304038600e5ee845e0dacdc6007711235542f798f69",
  "version": 2,
  "size": 346,
  "vsize": 265,
  "weight": 1057,
  "locktime": 0,
  "vin": [
    {
      "txid": "a9782e5dcf0f5d39dfa5fd4d4df70c45b0d1fbf61f2f6a068f3a3e2deab57819",
      "vout": 1,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "3044022009611056f2943b0fe3745c9eb4f9b29a0f4c4e12edd390b4c8eb54fa39a4568302205592df75fc5cbc5895b958c01e8430d14b820b9ed1f51b8ffef6f8b4b29edf1c01",
        "0228ae76be284ce77290c5b6cf984cdea75ddae69b726a212b551ce7eabc202898"
      ],
      "sequence": 4294967293
    }
  ],
  "vout": [
    {
      "value": 0.00020000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 19e6ed2a111bc28c517a6e59882f6e8e54b89685",
        "desc": "addr(tb1qr8nw62s3r0pgc5t6devcstmw3e2t3959m6tlly)#2c295gze",
        "hex": "001419e6ed2a111bc28c517a6e59882f6e8e54b89685",
        "address": "tb1qr8nw62s3r0pgc5t6devcstmw3e2t3959m6tlly",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00020000,
      "n": 1,
      "scriptPubKey": {
        "asm": "0 23c5a6249e03e37b8b1b060124ca947f59a02b03",
        "desc": "addr(tb1qy0z6vfy7q03hhzcmqcqjfj550av6q2crptcvnk)#5wr5nn7r",
        "hex": "001423c5a6249e03e37b8b1b060124ca947f59a02b03",
        "address": "tb1qy0z6vfy7q03hhzcmqcqjfj550av6q2crptcvnk",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00020000,
      "n": 2,
      "scriptPubKey": {
        "asm": "0 5dda1fed9c8a1c81c409767756a4a0b82e2535d1",
        "desc": "addr(tb1qthdplmvu3gwgr3qfwem4df9qhqhz2dw3gyl9ej)#60q4h7zf",
        "hex": "00145dda1fed9c8a1c81c409767756a4a0b82e2535d1",
        "address": "tb1qthdplmvu3gwgr3qfwem4df9qhqhz2dw3gyl9ej",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00020000,
      "n": 3,
      "scriptPubKey": {
        "asm": "0 af82621e256bcb3fbc8916d358dce0eba3ed607c",
        "desc": "addr(tb1q47pxy839d09nl0yfzmf43h8qaw376crujj7un6)#zc8uplzr",
        "hex": "0014af82621e256bcb3fbc8916d358dce0eba3ed607c",
        "address": "tb1q47pxy839d09nl0yfzmf43h8qaw376crujj7un6",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00020000,
      "n": 4,
      "scriptPubKey": {
        "asm": "0 74a2de597295152c4a8f394c84d9d46fdd5b1533",
        "desc": "addr(tb1qwj3duktjj52jcj5089xgfkw5dlw4k9fn2xm729)#qk9l6a00",
        "hex": "001474a2de597295152c4a8f394c84d9d46fdd5b1533",
        "address": "tb1qwj3duktjj52jcj5089xgfkw5dlw4k9fn2xm729",
        "type": "witness_v0_keyhash"
      }
    },
    {
      "value": 0.00898000,
      "n": 5,
      "scriptPubKey": {
        "asm": "0 425ea0cfc91740feda6c06aaf91500c156d38638",
        "desc": "addr(tb1qgf02pn7fzaq0aknvq640j9gqc9td8p3cw47wj8)#q8k6enpu",
        "hex": "0014425ea0cfc91740feda6c06aaf91500c156d38638",
        "address": "tb1qgf02pn7fzaq0aknvq640j9gqc9td8p3cw47wj8",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}

```

## 署名したトランザクションをブロードキャストする

```bash
bitcoin-core.cli   sendrawtransaction 020000000001011978b5ea2d3e3a8f066a2f1ff6fbd1b0450cf74d4dfda5df395d0fcf5d2e78a90100000000fdffffff06204e00000000000016001419e6ed2a111bc28c517a6e59882f6e8e54b89685204e00000000000016001423c5a6249e03e37b8b1b060124ca947f59a02b03204e0000000000001600145dda1fed9c8a1c81c409767756a4a0b82e2535d1204e000000000000160014af82621e256bcb3fbc8916d358dce0eba3ed607c204e00000000000016001474a2de597295152c4a8f394c84d9d46fdd5b1533d0b30d0000000000160014425ea0cfc91740feda6c06aaf91500c156d3863802473044022009611056f2943b0fe3745c9eb4f9b29a0f4c4e12edd390b4c8eb54fa39a4568302205592df75fc5cbc5895b958c01e8430d14b820b9ed1f51b8ffef6f8b4b29edf1c01210228ae76be284ce77290c5b6cf984cdea75ddae69b726a212b551ce7eabc20289800000000

=>
220dd7b0b29ef5c46659ea5ba4b0db2a99dcd6ae7e5c8062abbc72dd1343c98d
```

## 10分以上経過後，UTXOのリストを確認する

```bash
bitcoin-core.cli listunspent
=>
[
{
    "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
    "vout": 0,
    "address": "tb1qh9u2c2k2fhgfr683at3jv0dfcnxauvrv3mtnua",
    "label": "",
    "scriptPubKey": "0014b978ac2aca4dd091e8f1eae3263da9c4cdde306c",
    "amount": 0.00018000,
    "confirmations": 92,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/84']026d01d308b663a223ef89101829c02166cdc6df56a856ebdf2cb235132b19d469)#722a8gfc",
    "safe": true
  },
  {
    "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
    "vout": 1,
    "address": "tb1qjmzdu6md96xz539h5txxp8ng5gjyh8c33p460w",
    "label": "",
    "scriptPubKey": "001496c4de6b6d2e8c2a44b7a2cc609e68a2244b9f11",
    "amount": 0.00020000,
    "confirmations": 92,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/85']03ede51dfea3e994477ff29d3143f35c1c5b850c0491421749791a81e642cac70a)#f8yslp90",
    "safe": true
  },
  {
    "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
    "vout": 2,
    "address": "tb1qg2a6l3myvw79q6h0qwajqkla5fefuvynv9h89e",
    "label": "",
    "scriptPubKey": "001442bbafc76463bc506aef03bb205bfda2729e3093",
    "amount": 0.00020000,
    "confirmations": 92,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/86']03eb40f709e1c7983646cf8a9f593489936fe97e29f970a3d19d3b09df81b7e9a3)#v8amegdl",
    "safe": true
  },
  {
    "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
    "vout": 3,
    "address": "tb1qzqrcwc6fwh9kpgy39gv5gcra4q98we08vt43nl",
    "label": "",
    "scriptPubKey": "0014100787634975cb60a0912a1944607da80a7765e7",
    "amount": 0.00020000,
    "confirmations": 92,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/87']0318c2a2929e4be5885c05c4819618a637b4546e8010aea3200922fe2eed71b0ca)#j9fwnzvn",
    "safe": true
  },
  {
    "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
    "vout": 4,
    "address": "tb1qd6uvxm5mr2cunj9nnt54p4w9edvahe7qnlpdyd",
    "label": "",
    "scriptPubKey": "00146eb8c36e9b1ab1c9c8b39ae950d5c5cb59dbe7c0",
    "amount": 0.00020000,
    "confirmations": 92,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/88']03c012a70b37fe9f1f5e11e402f9b7fc81cdbf4d6d7b48bdc1608bd8607d78c8cd)#2qle0dvk",
    "safe": true
  }
]
```

作成した５つのUTXOは，それぞれ順にP2PK,　P2PKH，P2SH，P2WPKH，P2WSHの作成実験のために使います。

5個のUTXOからそれぞれP2PK, P2PKH, P2SH, P2WPKH, P2WSH の５つのタイプのoutputを持つ5個のトランザクションを作成し，それぞれ署名して，ブロードキャストする

## ビットコインアドレス

5種類の outputのタイプへの送金には、それぞれ対応するアドレスタイプを持つ送金先アドレスが必要です。

### アドレスタイプごとのビットコインアドレスの生成

```bash
getnewaddress <ラベル> <アドレスタイプ>
```

アドレスタイプ

* legacy (base52アドレス）このタイプにさらに P2PKHとP2SHがあります
* bech32 (Bech32アドレス）このタイプにさらにP2WPKHとP2WSHがありあす
* p2sh-segwit (後方互換のため，Bech32アドレスをP2SHでラップしたアドレス)
* P2PK では、送金先の公開鍵がそのまま送金先アドレスになります

### Bech32アドレスの生成（受領者の公開鍵ハッシュの場合）

```bash
bitcoin-core.cli getnewaddress user1 bech32
=>
tb1quk3jna5v87rpexc2c6j2jadczcuz4gsmqmffcp
```

### base52 アドレスの生成（受領者の公開鍵ハッシュの場合）

```bash
bitcoin-core.cli getnewaddress user2 legacy
=>
mtK2eEt7aWajvwJyuzuFG5yrGKfYyU3LMX
```

### スクリプトハッシュ（P2SH, P2WSH）のアドレス生成

公開鍵のハッシュ値ではなく、スクリプトのハッシュ値への送金を意味するアドレスです。

その典型例がマルチシグ（多重署名）です。

## マルチシグアドレスの生成

 m of n マルチシグ（n人の公開鍵の中でm人の署名があれば成功する署名）のためのアドレス生成です。<アドレスタイプ> の指定によって　P2SH　と　P2WSH　が区別されます。
 
アドレスの生成には、n人の署名者たちの公開鍵が必要です。

コマンドの文法

```
createmultisig <必要署名数 m> '[<公開鍵1>,<公開鍵2>,...,<公開鍵n>]' <アドレスタイプ>
```

マルチシグアドレス生成結果

```
{                            (json object)
  "address" : "str",         (string) The value of the new multisig address.
  "redeemScript" : "hex",    (string) The string value of the hex-encoded redemption script.
  "descriptor" : "str"       (string) The descriptor for this multisig
}
```

### マルチシグアドレス生成の実際と公開鍵の提示

ここでの例では、複数のアドレスを一つのワレットで生成していますが、実際は複数の人のワレットで生成します。

上記のように、マルチシグアドレスの生成には公開鍵が必要です。

しかし、アドレスごとの公開鍵は非公開情報です。したがって、マルチシグに参加する当事者がそれぞれ自分で自分の公開鍵を確認し、マルチシグアドレス生成者に提示する必要があります。


### 自分のワレットにある公開鍵の確認方法

コマンドの文法

```
getaddressinfo <（自分のワレットの）ビットコインアドレス>
```

実行例

以下の"pubkey": がそのアドレスの公開鍵です

```bash
bitcoin-core.cli getaddressinfo mhqjFfsQ1EAPwrKVzmE5XtRgzFdspfvmy6
=>
{
  "address": "mhqjFfsQ1EAPwrKVzmE5XtRgzFdspfvmy6",
  "scriptPubKey": "76a914197d44c8e2d272b032fac7f683ab83f288eac24588ac",
  "ismine": true,
  "solvable": true,
  "desc": "pkh([b6437264/0'/0'/90']03520a14c50dec5bcfb69b131a13307e4cd7919fc29af85920ee70e592a11ed525)#hyqyq8nw",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": false,
  "pubkey": "03520a14c50dec5bcfb69b131a13307e4cd7919fc29af85920ee70e592a11ed525",
  "iscompressed": true,
  "ischange": false,
  "timestamp": 1634103859,
  "hdkeypath": "m/0'/0'/90'",
  "hdseedid": "996145f9a9559745d1a132f74a31088ee18178af",
  "hdmasterfingerprint": "b6437264",
  "labels": [
    "user1"
  ]
}

```

### アドレスと公開鍵の例

base52アドレスの場合（実際は３名で個別に行います）

```bash
bitcoin-core.cli getaddressinfo mpQA33eE8oz3J3LxXg7Uezsy6tLwhk4YPq |grep pubkey
=>
  "pubkey": "0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4",
bitcoin-core.cli getaddressinfo n3vr6bsvDtnVRJpoCteabqm2nG6B6pCJni |grep pubkey
=>
  "pubkey": "03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645",
bitcoin-core.cli getaddressinfo mvPs97Ls1KP1h7HmHoQexnCUFPTib2gX8V |grep pubkey
=>
  "pubkey": "0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b",
```

### P2SHマルチシグアドレスの生成

３名から持ち寄った公開鍵のリストからP2SHアドレスを生成します。

ここでは署名の閾値ｍを２としてます。

```bash
bitcoin-core.cli createmultisig 2 '["0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4","03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645","0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b"]' legacy

=>
{
  "address": "2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2",
  "redeemScript": "52210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae",
  "descriptor": "sh(multi(2,0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#valuvj2y"
}

```

### P2SHアドレス

これが生成されたP2SHアドレスです

```
"address": "2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2"
```

公開鍵の順序が変わるとアドレスなども変わることに注意してください


### redeemScript

P2SHのアウトプットをアンロックするには、redeemScriptが必要です

上記のマルチシグアドレス生成時に対応する redeemscriptも生成されています．
それをコピー・ペーストすると以下のようになりｊます．

```
"redeemScript": "52210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae"
```

### descriptor

* マルチシグの実際の署名は、署名者それぞれのワレットでその秘密鍵を使って行います。
* その署名のためには、署名者のワレットにredeemScriptなどの必要な情報を組み込む必要があります。
* descriptor　は、ワレットにマルチシグ署名のための情報を組み込むためのデータです。

```
"descriptor": "sh(multi(2,0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#valuvj2y"
```

## P2WSHの場合

基本的にP2SHと同じです。

### 公開鍵のリスト

Bech32アドレスの場合（実際は３名で個別に行います）

```bash
bitcoin-core.cli getaddressinfo tb1qstrechqc0q9r6v7f7vl24aw5kml0ku07j7t7zf |grep pubkey
=>
  "pubkey": "0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65",
bitcoin-core.cli getaddressinfo tb1q8c5zmpejm8vap4tv05w4am92juapx69y0j7p5d |grep pubkey
=>
  "pubkey": "03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b",
bitcoin-core.cli getaddressinfo tb1qh9ym5r0zhq4d4wp6qacw3yh9e8mz9hcva87sj4 |grep pubkey
=>
  "pubkey": "0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b",
```

### マルチシグアドレスの生成

```bash
bitcoin-core.cli createmultisig 2 '["0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65","03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b","0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b"]' bech32
=>
{
  "address": "tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc",
  "redeemScript": "52210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae",
  "descriptor": "wsh(multi(2,0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#ezclpasq"
}
```

### P2WSHアドレス

```
tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc
```

### redeemScript

```
 "redeemScript": "52210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae"
```

### descriptor

```
 "descriptor": "wsh(multi(2,0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#ezclpasq"
```

## トランザクションの作成

５種類のアウトプットのタイプを持つトランザクションを作成します。

使用するUTXOは、先程生成したものです。

* txid: 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* vout: 0 ~ 4
* 資金： 0.0002


## P2PK（output）トランザクションの作成

（P2PKは難易度が高いので最後にまわします）

## P2PKH（output）トランザクションの作成

送金先アドレスを legacy なP2PKHにすればよい

```
bitcoin-core.cli getnewaddress user3 legacy
=>
mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt
```

### input(UTXO)　のJSON形式の例

inputに使用するUTXOのtxidとvout:1 を設定

* UTXOの資金は、0.0002
* 手数料を 0.00002とします。
* したがって、送金金額は、0.00018

```
'[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":1}]' 
```

### output のJSON形式の例

```
'[{"mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt": 0.00018}]'
```

### 未署名トランザクションの作成

```bash
bitcoin-core.cli createrawtransaction  '[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":1}]'  '[{"mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt": 0.00018}]'

=>
020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230100000000ffffffff0150460000000000001976a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac00000000
```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

```bash
 bitcoin-core.cli signrawtransactionwithwallet  020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230100000000ffffffff0150460000000000001976a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac00000000
=>
{
  "hex": "0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230100000000ffffffff0150460000000000001976a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac024730440220072d8db58f972f5bca3ba8b6c89902057700e75181aa9a51f095fb987c3404d102206e2a717202a2f701d8fab029a73d23d0bd0477f025fb86cfd4c6a3c64718d10d012103ede51dfea3e994477ff29d3143f35c1c5b850c0491421749791a81e642cac70a00000000",
  "complete": true
}
```

### 作成したトランザクションの確認

voutのタイプを確認してください

```bash
bitcoin-core.cli decoderawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230100000000ffffffff0150460000000000001976a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac024730440220072d8db58f972f5bca3ba8b6c89902057700e75181aa9a51f095fb987c3404d102206e2a717202a2f701d8fab029a73d23d0bd0477f025fb86cfd4c6a3c64718d10d012103ede51dfea3e994477ff29d3143f35c1c5b850c0491421749791a81e642cac70a00000000
=>
{
  "txid": "6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2",
  "hash": "f7553d64eba14662af337fec293f2c1097ebabb822a894d69f67e1b52a108d86",
  "version": 2,
  "size": 194,
  "vsize": 113,
  "weight": 449,
  "locktime": 0,
  "vin": [
    {
      "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
      "vout": 1,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "30440220072d8db58f972f5bca3ba8b6c89902057700e75181aa9a51f095fb987c3404d102206e2a717202a2f701d8fab029a73d23d0bd0477f025fb86cfd4c6a3c64718d10d01",
        "03ede51dfea3e994477ff29d3143f35c1c5b850c0491421749791a81e642cac70a"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00018000,
      "n": 0,
      "scriptPubKey": {
        "asm": "OP_DUP OP_HASH160 424986ff15df8a17a04f2b07520f0ef1dc9b7422 OP_EQUALVERIFY OP_CHECKSIG",
        "desc": "addr(mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt)#uzurxzra",
        "hex": "76a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac",
        "address": "mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt",
        "type": "pubkeyhash"
      }
    }
  ]
}

```

### P2PKHトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230100000000ffffffff0150460000000000001976a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac024730440220072d8db58f972f5bca3ba8b6c89902057700e75181aa9a51f095fb987c3404d102206e2a717202a2f701d8fab029a73d23d0bd0477f025fb86cfd4c6a3c64718d10d012103ede51dfea3e994477ff29d3143f35c1c5b850c0491421749791a81e642cac70a00000000

=>
6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2
```

--
## P2SH（output）トランザクションの作成
--
input に使用するUTXOは

* txid: 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* vout: 2
* 送金金額は、0.00018


送金先アドレスを先に生成済の P2SH アドレスにすればよい

```bash
{
  "address": "2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2",
  "redeemScript": "52210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae",
  "descriptor": "sh(multi(2,0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#valuvj2y"
}
```

### input(UTXO)　のJSON形式の例

```bash
'[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":2}]' 
```

### output のJSON形式の例

```bash
'[{"2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2":0.00018}]'
```

### 未署名トランザクションの作成

```bash
bitcoin-core.cli createrawtransaction  '[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":2}]'  '[{"2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2":0.00018}]'
=>
020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230200000000ffffffff01504600000000000017a914bb1b9d3762f5964beb822227eca7896c834b77758700000000
```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

```bash
bitcoin-core.cli signrawtransactionwithwallet 020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230200000000ffffffff01504600000000000017a914bb1b9d3762f5964beb822227eca7896c834b77758700000000
=>
{
  "hex": "0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230200000000ffffffff01504600000000000017a914bb1b9d3762f5964beb822227eca7896c834b7775870247304402200f48380f49d4c64218ffe3aa6527121717f2103ff7acc639dd1da4ddbbb5b2cf02205ab3597af25f71399bd1663e73c5ebd1815405eb9ef2d7345bd137bba4f6b1fa012103eb40f709e1c7983646cf8a9f593489936fe97e29f970a3d19d3b09df81b7e9a300000000",
  "complete": true
}
```

### P2SHトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230200000000ffffffff01504600000000000017a914bb1b9d3762f5964beb822227eca7896c834b7775870247304402200f48380f49d4c64218ffe3aa6527121717f2103ff7acc639dd1da4ddbbb5b2cf02205ab3597af25f71399bd1663e73c5ebd1815405eb9ef2d7345bd137bba4f6b1fa012103eb40f709e1c7983646cf8a9f593489936fe97e29f970a3d19d3b09df81b7e9a300000000

=>
a0faa783f92fdb8bdee3e134f92ce1a163c36a4574ff494985e54665b2a70d41
```

--
## P2WPKH（output）トランザクションの作成
--

送金先アドレスを　P2WPKH アドレスにすればよい

```bash
bitcoin-core.cli getnewaddress
=>
tb1q9ejzgpj47rpt6j86c2epvzgz654caek2ga36tn
```

* txid: 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* vout: 3
* 送金金額は、0.00018

### input(UTXO)　のJSON形式の例

```bash
'[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":3}]' 
```

### output のJSON形式の例

```bash
'[{"tb1q9ejzgpj47rpt6j86c2epvzgz654caek2ga36tn": 0.00018}]'
```

### 未署名トランザクションの作成

```bash
bitcoin-core.cli createrawtransaction  '[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":3}]' '[{"tb1q9ejzgpj47rpt6j86c2epvzgz654caek2ga36tn": 0.00018}]'
=>
020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230300000000ffffffff0150460000000000001600142e64240655f0c2bd48fac2b2160902d52b8ee6ca00000000
```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

```bash
bitcoin-core.cli signrawtransactionwithwallet 020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230300000000ffffffff0150460000000000001600142e64240655f0c2bd48fac2b2160902d52b8ee6ca00000000
=>
{
  "hex": "0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230300000000ffffffff0150460000000000001600142e64240655f0c2bd48fac2b2160902d52b8ee6ca02473044022058120e37fddacdfeccce7e86a60fc624c6c6d519198d9f5e8ce569306ed466cb02207fdb57de7e725fce3dec3eb1175771fda83a002e93793475687729987e32724001210318c2a2929e4be5885c05c4819618a637b4546e8010aea3200922fe2eed71b0ca00000000",
  "complete": true
}
```
### P2WPKHトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230300000000ffffffff0150460000000000001600142e64240655f0c2bd48fac2b2160902d52b8ee6ca02473044022058120e37fddacdfeccce7e86a60fc624c6c6d519198d9f5e8ce569306ed466cb02207fdb57de7e725fce3dec3eb1175771fda83a002e93793475687729987e32724001210318c2a2929e4be5885c05c4819618a637b4546e8010aea3200922fe2eed71b0ca00000000
=>
aa9d14b180f967d85f579b7d90151e5f6f5c7dbf81198d2ca0411fbcb119470a
```


## P2WSH（output）トランザクションの作成

送金先アドレスを P2WSH アドレスにすればよい

```
{
  "address": "tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc",
  "redeemScript": "52210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae",
  "descriptor": "wsh(multi(2,0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#ezclpasq"
}
```

使用するUTXO

* txid: 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* vout: 4
* 送金金額は、0.00018

### input(UTXO)　のJSON形式の例

```
'[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":4}]' 
```

### output のJSON形式の例

```
'[{"tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc": 0.00018}]'
```

### 未署名トランザクションの作成

```bash
bitcoin-core.cli createrawtransaction  '[{"txid":"236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833","vout":4}]' '[{"tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc": 0.00018}]'

=>
020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230400000000ffffffff015046000000000000220020ccd0eb673f029cb8dc7d86a3223e36405a33750a540cf26c5c40013e1e37c02000000000
```

### トランザクションへのデジタル署名（ワレットの秘密鍵を利用）

```bash
bitcoin-core.cli signrawtransactionwithwallet 020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230400000000ffffffff015046000000000000220020ccd0eb673f029cb8dc7d86a3223e36405a33750a540cf26c5c40013e1e37c02000000000
=>
{
  "hex": "0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230400000000ffffffff015046000000000000220020ccd0eb673f029cb8dc7d86a3223e36405a33750a540cf26c5c40013e1e37c02002473044022001beee68e94fb8dfe56a8a31c0668b4b1a29eb0f338b842ed67a65cb58e6930902205736678e57d9dd61759b246c3920d49236e563f007fc288126e56eba0aeb5bee012103c012a70b37fe9f1f5e11e402f9b7fc81cdbf4d6d7b48bdc1608bd8607d78c8cd00000000",
  "complete": true
}
```

### P2WSHトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230400000000ffffffff015046000000000000220020ccd0eb673f029cb8dc7d86a3223e36405a33750a540cf26c5c40013e1e37c02002473044022001beee68e94fb8dfe56a8a31c0668b4b1a29eb0f338b842ed67a65cb58e6930902205736678e57d9dd61759b246c3920d49236e563f007fc288126e56eba0aeb5bee012103c012a70b37fe9f1f5e11e402f9b7fc81cdbf4d6d7b48bdc1608bd8607d78c8cd00000000
=>
89f1855f19cf3280aa842d1cb1e38442e98a47c475a1a340813bed5536f2ec6e
```


## P2PK（output）トランザクションの作成

bitcoin core のAPIでは　P2PKのトランザクション作成機能は削除されているので，自分でトランザクションの内容を仕様にそって自作する必要があります。

* input が参照するUTXOのTXIDはリトルエンディアン
* ScriptPubkeyの最後の１バイトは， OP_CHECKSIG (コードは16進数で "ac")
* valueの値は送金金額の単位が 1億分の1 BTC = 1 satoshi
* valueの値は 8バイトのリトルエンディアンであることに注意が必要です。

input に使用するUTXOは

* txid: 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* vout: 0
* 送金金額は、0.00016


### リトルエンディアン変換

Rubyのビッグエンディアンからリトルエンディアンへの変換プログラム

```ruby
# ビッグエンディアンのデータ
be ="00000000001de840"
# リトルエンディアンへの変換
le=[be].pack('H*').reverse.unpack('H*')[0]
# 変換結果
"40e81d0000000000"
```

* outputのvalue: 0.00016 BTC
* 0.00016 btc=16000 satoshi 

```ruby
# 16000 は、8バイトの16進数では，0000000000003e80
# 8バイトのリトルエンディアン表現にすると
be="0000000000003e80"
le=[be].pack('H*').reverse.unpack('H*')[0]
# 変換結果
"803e000000000000"
```

* トランザクション

| フィールド    | 内容       |
|:-------- |:-------- |
| version  | 02000000 |
| inputの数  | 01       |
| input    |          |
| outputの数 | 01       |
| output   |          |
| nLocTime | 00000000 |

トランザクションデータの連結結果

```
02000000
01<input>
01<output>
00000000
```

### input (UTXO)

* 236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833
* "33d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df6696823"(リトルエンディアン)
* vout:0

| フィールド        | 内容                                                               |
|:------------ |:---------------------------------------------------------------- |
| トランザクションID   | 33d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df6696823 |
| txout index  | 0000000000                                                       |
| ScriptSigサイズ | 空                                                                |
| ScriptSig    | 空                                                                |
| nSequence    | ffffffff                                                         |

inputデータの連結結果

```
33d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff
```

### output 

```
bitcoin-core.cli getnewaddress
=>
tb1qyfdlldk7pf2t0gqnmu3nzrh6yfz5l6y9ewcmyz

bitcoin-core.cli getaddressinfo tb1qyfdlldk7pf2t0gqnmu3nzrh6yfz5l6y9ewcmyz |grep pubkey
=>
  "pubkey": "0286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225",
```

| フィールド              | 内容                                                                 |
|:------------------ |:------------------------------------------------------------------ |
| value              | 803e000000000000                                                   |
| scriputPubKeyのバイト数 | 23                                                                 |
| scriputPubKey      | 21(公開鍵サイズ33バイトの16進数表記）                                                  |
| 送金先公開鍵             | 0286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225 |
| OP_CHECKSIG        | ac                                                                 |

### outputデータの連結結果

```
803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac
```

### P2PKトランザクションの作成

```
02000000
01
33d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff
01
803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac
00000000
```

### 作成したトランザクションの構造の確認

```bash
bitcoin-core.cli decoderawtransaction 020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff01803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac00000000
=>
{
  "txid": "08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c",
  "hash": "08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c",
  "version": 2,
  "size": 95,
  "vsize": 95,
  "weight": 380,
  "locktime": 0,
  "vin": [
    {
      "txid": "236869f63d84cca47ae697f5b69f5b4b297da2535aa58cda6d7ff9dd7b47d833",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00016000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225 OP_CHECKSIG",
        "desc": "pk(0286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225)#zw9cajag",
        "hex": "210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac",
        "type": "pubkey"
      }
    }
  ]
}
```

### 作成したトランザクションへの署名

```bash
bitcoin-core.cli signrawtransactionwithwallet 020000000133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff01803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac00000000
=>
{
  "hex": "0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff01803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac024730440220163aca210506175bd5f4e792a49aeb5fe1965cbefb6bc8a55a782554878d2d340220016dfc3a249ff6e7302eceb34102834e1c07c14300556a3fb7872a3abd1cd5f70121026d01d308b663a223ef89101829c02166cdc6df56a856ebdf2cb235132b19d46900000000",
  "complete": true
}
```

### P2PKトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 0200000000010133d8477bddf97f6dda8ca55a53a27d294b5b9fb6f597e67aa4cc843df66968230000000000ffffffff01803e00000000000023210286cccece9b23c2079a9fac439efdccf5cbb04154817617ff4a4fd4668db8b225ac024730440220163aca210506175bd5f4e792a49aeb5fe1965cbefb6bc8a55a782554878d2d340220016dfc3a249ff6e7302eceb34102834e1c07c14300556a3fb7872a3abd1cd5f70121026d01d308b663a223ef89101829c02166cdc6df56a856ebdf2cb235132b19d46900000000
=>
08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c
```


## 5種類のUTXOを消費するトランザクションの作成

### UTXOの確認

この時点で　bitcoin core のワレット機能でUTXOとして確認可能なものは　P2PK, P2PKH, P2WPKH のoutputだけです。

P2SHとP2WSHのUTXOは，ワレットには認識されません。

```bash
bitcoin-core.cli listunspent
=>
[
  {
    "txid": "aa9d14b180f967d85f579b7d90151e5f6f5c7dbf81198d2ca0411fbcb119470a",
    "vout": 0,
    "address": "tb1q9ejzgpj47rpt6j86c2epvzgz654caek2ga36tn",
    "label": "",
    "scriptPubKey": "00142e64240655f0c2bd48fac2b2160902d52b8ee6ca",
    "amount": 0.00018000,
    "confirmations": 4,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/98']031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b)#jvqdyz33",
    "safe": true
  },

  {
    "txid": "6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2",
    "vout": 0,
    "address": "mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt",
    "label": "user3",
    "scriptPubKey": "76a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac",
    "amount": 0.00018000,
    "confirmations": 12,
    "spendable": true,
    "solvable": true,
    "desc": "pkh([b6437264/0'/0'/97']0222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701)#24jv8ctw",
    "safe": true
  },
  {
    "txid": "08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c",
    "vout": 0,
    "address": "mgX9TGp5SxT6jczaKhf6fVDUdfsg1m45wf",
    "scriptPubKey": "21027544b898d2d886a7ee733f2cf3da01bfd5d2350fedf602f4d1b78412b5f4d851ac",
    "amount": 0.00016000,
    "confirmations": 1,
    "spendable": true,
    "solvable": true,
    "desc": "pk([60d80dee/0'/0'/35']027544b898d2d886a7ee733f2cf3da01bfd5d2350fedf602f4d1b78412b5f4d851)#24lz4ah2",
    "safe": true
  }
]
```

### bitcoin core のワレットにマルチシグ情報を登録する

P2SHとP2WSHのマルチシグアドレス生成時に生成された descriptorを利用する

* P2SHのdescriptor

```
"sh(multi(2,0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#valuvj2y"
```

* P2WSHのdescriptor

```
"wsh(multi(2,0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#ezclpasq"
```

一般的には，マルチシグは複数の主体のワレットで署名しなければなりません。
この例では，単純化のために署名に必要なすべての秘密鍵が一つのワレットに入っています。

```
importmulti <JSON形式のインポート情報(descriptor)> 
```

```bash
 bitcoin-core.cli importmulti '[{"desc": "sh(multi(2,0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#valuvj2y", "timestamp": "now", "watchonly": true}]'
=>
 [
  {
    "success": true
  }
]
```

```bash
bitcoin-core.cli importmulti '[{"desc": "wsh(multi(2,0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#ezclpasq","timestamp": "now", "watchonly": true}]'

[
  {
    "success": true
  }
]
```

### これでワレットがP2SH, P2WSH を含めたすべてのUTXOを確認できるようになる

```bash
bitcoin-core.cli listunspent
=>
[
  {
    "txid": "aa9d14b180f967d85f579b7d90151e5f6f5c7dbf81198d2ca0411fbcb119470a",
    "vout": 0,
    "address": "tb1q9ejzgpj47rpt6j86c2epvzgz654caek2ga36tn",
    "label": "",
    "scriptPubKey": "00142e64240655f0c2bd48fac2b2160902d52b8ee6ca",
    "amount": 0.00018000,
    "confirmations": 4,
    "spendable": true,
    "solvable": true,
    "desc": "wpkh([b6437264/0'/0'/98']031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b)#jvqdyz33",
    "safe": true
  },

  {
    "txid": "6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2",
    "vout": 0,
    "address": "mmZSyUyxaZJJNXCviNmUcg2jJ5KfSUJMZt",
    "label": "user3",
    "scriptPubKey": "76a914424986ff15df8a17a04f2b07520f0ef1dc9b742288ac",
    "amount": 0.00018000,
    "confirmations": 12,
    "spendable": true,
    "solvable": true,
    "desc": "pkh([b6437264/0'/0'/97']0222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701)#24jv8ctw",
    "safe": true
  },
  {
    "txid": "08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c",
    "vout": 0,
    "address": "mgX9TGp5SxT6jczaKhf6fVDUdfsg1m45wf",
    "scriptPubKey": "21027544b898d2d886a7ee733f2cf3da01bfd5d2350fedf602f4d1b78412b5f4d851ac",
    "amount": 0.00016000,
    "confirmations": 1,
    "spendable": true,
    "solvable": true,
    "desc": "pk([60d80dee/0'/0'/35']027544b898d2d886a7ee733f2cf3da01bfd5d2350fedf602f4d1b78412b5f4d851)#24lz4ah2",
    "safe": true
  },
  {
    "txid": "89f1855f19cf3280aa842d1cb1e38442e98a47c475a1a340813bed5536f2ec6e",
    "vout": 0,
    "address": "tb1qengwkeelq2wt3hras63jy03kgpdrxag22sx0ymzugqqnu83hcqsqk3wekc",
    "label": "",
    "witnessScript": "52210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae",
    "scriptPubKey": "0020ccd0eb673f029cb8dc7d86a3223e36405a33750a540cf26c5c40013e1e37c020",
    "amount": 0.00018000,
    "confirmations": 3,
    "spendable": false,
    "solvable": true,
    "desc": "wsh(multi(2,[82c79c5c]0380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a65,[3e282d87]03efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b,[b949ba0d]0290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b))#4cr4ee97",
    "safe": true
  },
    {
    "txid": "a0faa783f92fdb8bdee3e134f92ce1a163c36a4574ff494985e54665b2a70d41",
    "vout": 0,
    "address": "2NAJZRpUeBUycwZHrcDRKsyufsUx25Djgw2",
    "label": "",
    "redeemScript": "52210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae",
    "scriptPubKey": "a914bb1b9d3762f5964beb822227eca7896c834b777587",
    "amount": 0.00018000,
    "confirmations": 4,
    "spendable": true,
    "solvable": true,
    "desc": "sh(multi(2,[6170057b]0237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d4,[f5d793b3]03ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645,[a332ac29]0345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b))#yqy68cgc",
    "safe": true
  }
]
```

### 送金先と金額

```bash
bitcoin-core.cli getnewaddress 
=>
tb1qhj7y9rup50pqnuckuqluge63enffguymm7j5ue
```

送金金額：0.00088-0.00002=0.00086

## ５つのinputを持つ未署名のトランザクションの作成

P2PK, P2PKH, P2SH,P2WPKH,P2WSH の順で作成する

```bash
bitcoin-core.cli createrawtransaction  '[{"txid":"08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c","vout":0},{"txid":"6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2","vout":0},{"txid":"a0faa783f92fdb8bdee3e134f92ce1a163c36a4574ff494985e54665b2a70d41","vout":0},{"txid":"aa9d14b180f967d85f579b7d90151e5f6f5c7dbf81198d2ca0411fbcb119470a","vout":0},{"txid":"89f1855f19cf3280aa842d1cb1e38442e98a47c475a1a340813bed5536f2ec6e","vout":0}]'  '[{"tb1qhj7y9rup50pqnuckuqluge63enffguymm7j5ue": 0.00086}]'
=>
02000000059c37889ca84172912da31ebe8a71de19680e75adf41da05dddb04d0d7f1c70080000000000ffffffffc23e1e71e88ae22af278c688571b5e568ad7503467cf49f61286ffb1efc0e46a0000000000ffffffff410da7b26546e5854949ff74456ac363a1e12cf934e1e3de8bdb2ff983a7faa00000000000ffffffff0a4719b1bc1f41a02c8d1981bf7d5c6f5f1e15907d9b575fd867f980b1149daa0000000000ffffffff6eecf23655ed3b8140a3a175c4478ae94284e3b11c2d84aa8032cf195f85f1890000000000ffffffff01f04f010000000000160014bcbc428f81a3c209f316e03fc46751ccd294709b00000000
```

### トランザクションへの署名

実際の運用では，マルチシグは複数の主体のワレットで順番に署名する必要があります。

```bash
bitcoin-core.cli signrawtransactionwithwallet 02000000059c37889ca84172912da31ebe8a71de19680e75adf41da05dddb04d0d7f1c70080000000000ffffffffc23e1e71e88ae22af278c688571b5e568ad7503467cf49f61286ffb1efc0e46a0000000000ffffffff410da7b26546e5854949ff74456ac363a1e12cf934e1e3de8bdb2ff983a7faa00000000000ffffffff0a4719b1bc1f41a02c8d1981bf7d5c6f5f1e15907d9b575fd867f980b1149daa0000000000ffffffff6eecf23655ed3b8140a3a175c4478ae94284e3b11c2d84aa8032cf195f85f1890000000000ffffffff01f04f010000000000160014bcbc428f81a3c209f316e03fc46751ccd294709b00000000
=>
{
  "hex": "020000000001059c37889ca84172912da31ebe8a71de19680e75adf41da05dddb04d0d7f1c7008000000004847304402207af64ee819d4508afd2d87845f9b0b45bfff4d3b8b48ef6254696c6594e456f8022002754510969fc71f0d1e7dbff0fb7de5c1a3791fcaa510843b41f212238069cd01ffffffffc23e1e71e88ae22af278c688571b5e568ad7503467cf49f61286ffb1efc0e46a000000006a4730440220263aa6dbd8408800e6a02c9085ea6a444b2ab78891792eb57f49f4ade581431602207a5b3f18270f2ec0de58b07d6c274954aacb627eca381e568d937411feaf083401210222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701ffffffff410da7b26546e5854949ff74456ac363a1e12cf934e1e3de8bdb2ff983a7faa000000000fc0047304402206e60f211d72c34c16be004e756ed490c5c79d376c479c146512c2487069781c602200473c8442b507fea1b7ee7274431698278c9893a8da1b6734ca444df7b2102aa0147304402200d844c231012bcc36a0774adf8677b948dd841838ae3ebb750ed497fc2a71314022073eace5173560c9f72bef661cbf80ea8f6594bb80bd4aa0c0d8eb96cb312cc6f014c6952210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53aeffffffff0a4719b1bc1f41a02c8d1981bf7d5c6f5f1e15907d9b575fd867f980b1149daa0000000000ffffffff6eecf23655ed3b8140a3a175c4478ae94284e3b11c2d84aa8032cf195f85f1890000000000ffffffff01f04f010000000000160014bcbc428f81a3c209f316e03fc46751ccd294709b0000000247304402200e9082682885eacee1f8c5381aa022d709af7ce2b5d36d2392c6756cd80c28ac0220358b6b255401ffcaa0d593715b85245fbe9a525a0ebe64793a41d017e816341f0121031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b040047304402206267cf7c180d2f1245955fbee57ae657cba0dc82e6a253d1b8ffbc3915af3df302203e2c1d241e8c152436d7fbc01b36beca1b98e98be990b03845c4d21a62b0d685014730440220278a80c5d9cf17b6e3486788dca63262407ab4999eb79521b92e18bb5a368ee002206139aabd54bf82e3482200e1c7c6940ef67045735198dcb6d2a99ab1828b4680016952210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae00000000",
  "complete": true
}
```

### 作成したトランザクションの構造

```bash
bitcoin-core.cli decoderawtransaction 020000000001059c37889ca84172912da31ebe8a71de19680e75adf41da05dddb04d0d7f1c7008000000004847304402207af64ee819d4508afd2d87845f9b0b45bfff4d3b8b48ef6254696c6594e456f8022002754510969fc71f0d1e7dbff0fb7de5c1a3791fcaa510843b41f212238069cd01ffffffffc23e1e71e88ae22af278c688571b5e568ad7503467cf49f61286ffb1efc0e46a000000006a4730440220263aa6dbd8408800e6a02c9085ea6a444b2ab78891792eb57f49f4ade581431602207a5b3f18270f2ec0de58b07d6c274954aacb627eca381e568d937411feaf083401210222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701ffffffff410da7b26546e5854949ff74456ac363a1e12cf934e1e3de8bdb2ff983a7faa000000000fc0047304402206e60f211d72c34c16be004e756ed490c5c79d376c479c146512c2487069781c602200473c8442b507fea1b7ee7274431698278c9893a8da1b6734ca444df7b2102aa0147304402200d844c231012bcc36a0774adf8677b948dd841838ae3ebb750ed497fc2a71314022073eace5173560c9f72bef661cbf80ea8f6594bb80bd4aa0c0d8eb96cb312cc6f014c6952210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53aeffffffff0a4719b1bc1f41a02c8d1981bf7d5c6f5f1e15907d9b575fd867f980b1149daa0000000000ffffffff6eecf23655ed3b8140a3a175c4478ae94284e3b11c2d84aa8032cf195f85f1890000000000ffffffff01f04f010000000000160014bcbc428f81a3c209f316e03fc46751ccd294709b0000000247304402200e9082682885eacee1f8c5381aa022d709af7ce2b5d36d2392c6756cd80c28ac0220358b6b255401ffcaa0d593715b85245fbe9a525a0ebe64793a41d017e816341f0121031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b040047304402206267cf7c180d2f1245955fbee57ae657cba0dc82e6a253d1b8ffbc3915af3df302203e2c1d241e8c152436d7fbc01b36beca1b98e98be990b03845c4d21a62b0d685014730440220278a80c5d9cf17b6e3486788dca63262407ab4999eb79521b92e18bb5a368ee002206139aabd54bf82e3482200e1c7c6940ef67045735198dcb6d2a99ab1828b4680016952210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae00000000
=>
{
  "txid": "11f36ca7c4840c2cd24dd58d061bd30ccad3a8e0885920dd6daca9c855372756",
  "hash": "bd8acb3055541202a3de6fb53dfa5fe1d82e00b334ab7223884f9aa68c1f06f6",
  "version": 2,
  "size": 1040,
  "vsize": 767,
  "weight": 3068,
  "locktime": 0,
  "vin": [
    {
      "txid": "08701c7f0d4db0dd5da01df4ad750e6819de718abe1ea32d917241a89c88379c",
      "vout": 0,
      "scriptSig": {
        "asm": "304402207af64ee819d4508afd2d87845f9b0b45bfff4d3b8b48ef6254696c6594e456f8022002754510969fc71f0d1e7dbff0fb7de5c1a3791fcaa510843b41f212238069cd[ALL]",
        "hex": "47304402207af64ee819d4508afd2d87845f9b0b45bfff4d3b8b48ef6254696c6594e456f8022002754510969fc71f0d1e7dbff0fb7de5c1a3791fcaa510843b41f212238069cd01"
      },
      "sequence": 4294967295
    },
    {
      "txid": "6ae4c0efb1ff8612f649cf673450d78a565e1b5788c678f22ae28ae8711e3ec2",
      "vout": 0,
      "scriptSig": {
        "asm": "30440220263aa6dbd8408800e6a02c9085ea6a444b2ab78891792eb57f49f4ade581431602207a5b3f18270f2ec0de58b07d6c274954aacb627eca381e568d937411feaf0834[ALL] 0222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701",
        "hex": "4730440220263aa6dbd8408800e6a02c9085ea6a444b2ab78891792eb57f49f4ade581431602207a5b3f18270f2ec0de58b07d6c274954aacb627eca381e568d937411feaf083401210222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701"
      },
      "sequence": 4294967295
    },
    {
      "txid": "a0faa783f92fdb8bdee3e134f92ce1a163c36a4574ff494985e54665b2a70d41",
      "vout": 0,
      "scriptSig": {
        "asm": "0 304402206e60f211d72c34c16be004e756ed490c5c79d376c479c146512c2487069781c602200473c8442b507fea1b7ee7274431698278c9893a8da1b6734ca444df7b2102aa[ALL] 304402200d844c231012bcc36a0774adf8677b948dd841838ae3ebb750ed497fc2a71314022073eace5173560c9f72bef661cbf80ea8f6594bb80bd4aa0c0d8eb96cb312cc6f[ALL] 52210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae",
        "hex": "0047304402206e60f211d72c34c16be004e756ed490c5c79d376c479c146512c2487069781c602200473c8442b507fea1b7ee7274431698278c9893a8da1b6734ca444df7b2102aa0147304402200d844c231012bcc36a0774adf8677b948dd841838ae3ebb750ed497fc2a71314022073eace5173560c9f72bef661cbf80ea8f6594bb80bd4aa0c0d8eb96cb312cc6f014c6952210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53ae"
      },
      "sequence": 4294967295
    },
    {
      "txid": "aa9d14b180f967d85f579b7d90151e5f6f5c7dbf81198d2ca0411fbcb119470a",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "304402200e9082682885eacee1f8c5381aa022d709af7ce2b5d36d2392c6756cd80c28ac0220358b6b255401ffcaa0d593715b85245fbe9a525a0ebe64793a41d017e816341f01",
        "031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b"
      ],
      "sequence": 4294967295
    },
    {
      "txid": "89f1855f19cf3280aa842d1cb1e38442e98a47c475a1a340813bed5536f2ec6e",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "txinwitness": [
        "",
        "304402206267cf7c180d2f1245955fbee57ae657cba0dc82e6a253d1b8ffbc3915af3df302203e2c1d241e8c152436d7fbc01b36beca1b98e98be990b03845c4d21a62b0d68501",
        "30440220278a80c5d9cf17b6e3486788dca63262407ab4999eb79521b92e18bb5a368ee002206139aabd54bf82e3482200e1c7c6940ef67045735198dcb6d2a99ab1828b468001",
        "52210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae"
      ],
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.00086000,
      "n": 0,
      "scriptPubKey": {
        "asm": "0 bcbc428f81a3c209f316e03fc46751ccd294709b",
        "desc": "addr(tb1qhj7y9rup50pqnuckuqluge63enffguymm7j5ue)#qxp8yjj5",
        "hex": "0014bcbc428f81a3c209f316e03fc46751ccd294709b",
        "address": "tb1qhj7y9rup50pqnuckuqluge63enffguymm7j5ue",
        "type": "witness_v0_keyhash"
      }
    }
  ]
}

```

### 署名済のトランザクションのブロードキャスト

```bash
bitcoin-core.cli sendrawtransaction 020000000001059c37889ca84172912da31ebe8a71de19680e75adf41da05dddb04d0d7f1c7008000000004847304402207af64ee819d4508afd2d87845f9b0b45bfff4d3b8b48ef6254696c6594e456f8022002754510969fc71f0d1e7dbff0fb7de5c1a3791fcaa510843b41f212238069cd01ffffffffc23e1e71e88ae22af278c688571b5e568ad7503467cf49f61286ffb1efc0e46a000000006a4730440220263aa6dbd8408800e6a02c9085ea6a444b2ab78891792eb57f49f4ade581431602207a5b3f18270f2ec0de58b07d6c274954aacb627eca381e568d937411feaf083401210222e18123552767a58da9f3749a4fd014fe991be3469d0ee01618080734ec6701ffffffff410da7b26546e5854949ff74456ac363a1e12cf934e1e3de8bdb2ff983a7faa000000000fc0047304402206e60f211d72c34c16be004e756ed490c5c79d376c479c146512c2487069781c602200473c8442b507fea1b7ee7274431698278c9893a8da1b6734ca444df7b2102aa0147304402200d844c231012bcc36a0774adf8677b948dd841838ae3ebb750ed497fc2a71314022073eace5173560c9f72bef661cbf80ea8f6594bb80bd4aa0c0d8eb96cb312cc6f014c6952210237a1e78baa7be5389c51f1836fb3b52c7163ea869281559c8ac94e69898793d42103ab2e94ae215cb3bdba9269588f32c8df33c2140a554149850e01aa18b2bea645210345e92ef8d7d03efce3878360b0fc57bb82d5d291e9e483c296f409165b80121b53aeffffffff0a4719b1bc1f41a02c8d1981bf7d5c6f5f1e15907d9b575fd867f980b1149daa0000000000ffffffff6eecf23655ed3b8140a3a175c4478ae94284e3b11c2d84aa8032cf195f85f1890000000000ffffffff01f04f010000000000160014bcbc428f81a3c209f316e03fc46751ccd294709b0000000247304402200e9082682885eacee1f8c5381aa022d709af7ce2b5d36d2392c6756cd80c28ac0220358b6b255401ffcaa0d593715b85245fbe9a525a0ebe64793a41d017e816341f0121031b6f543a2a7ddd2b1358a2b1bdbef666cb302904b53dfc2f066889e914e4bb5b040047304402206267cf7c180d2f1245955fbee57ae657cba0dc82e6a253d1b8ffbc3915af3df302203e2c1d241e8c152436d7fbc01b36beca1b98e98be990b03845c4d21a62b0d685014730440220278a80c5d9cf17b6e3486788dca63262407ab4999eb79521b92e18bb5a368ee002206139aabd54bf82e3482200e1c7c6940ef67045735198dcb6d2a99ab1828b4680016952210380204524e4cf427a5a5da5826b531bc327c869230118433c5ab503544d1c1a652103efe8c25a79d87030ca57d1a630afd214bd7058563dcb35aee31f82bda571955b210290d9f66da40f2c4962b20d5a1e3ad6a3694fdfc60fef4df1126a9d54984b9e0b53ae00000000
=>
11f36ca7c4840c2cd24dd58d061bd30ccad3a8e0885920dd6daca9c855372756
```
