# 4. ERC20 ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½œæˆã¨åˆ©ç”¨

2024/11/26
Shigeichiro Yamasaki

OpenZeppelin ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ãŸ ERC20ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‡¦ç†ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ

## ERC-20ã®ä»•æ§˜

[ERC-20: Token Standard](https://eips.ethereum.org/EIPS/eip-20)

### ERC-20 ã®ãƒ¡ã‚½ãƒƒãƒ‰

* name 
  * ãƒˆãƒ¼ã‚¯ãƒ³ã®åå‰ã‚’è¿”ã™
  * `function name() public view returns (string)`
* symbol
  * ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚·ãƒ³ãƒœãƒ«ã‚’è¿”ã™
  * `function symbol() public view returns (string)`
* decimals
  * ãƒˆãƒ¼ã‚¯ãƒ³ãŒä½¿ç”¨ã™ã‚‹ 10é€²æ•°ã®å°æ•°ç‚¹ä»¥ä¸‹ã®æ¡æ•°ã‚’è¿”ã™
  * `function decimals() public view returns (uint8)`
* totalSupply
  * ãƒˆãƒ¼ã‚¯ãƒ³ã®ç·ä¾›çµ¦é‡ã‚’è¿”ã™
  * `function totalSupply() public view returns (uint256)`
* balanceOf
  * ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæ‰€æœ‰ã—ã¦ã„ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ®‹é«˜ã‚’è¿”ã™
  * `function balanceOf(address _owner) public view returns (uint256 balance)`
* transfer
  * é‡‘é¡ _value ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ _to ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ã‚‹
  * `function transfer(address _to, uint256 _value) public returns (bool success)`
* transferFrom
  * ä»£ç†ã§ _from ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ _to ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«é‡‘é¡ _value ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ã‚‹
  * `function transferFrom(address _from, address _to, uint256 _value) public returns (bool success)`
* approve
  * _spender ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦ _value ã§æŒ‡å®šã—ãŸé‡‘é¡ã¾ã§è¤‡æ•°å›žå¼•ãå‡ºã™ã“ã¨ã‚’æ‰¿èªã™ã‚‹
  * `function approve(address _spender, uint256 _value) public returns (bool success)`
* allowance
  * _spender ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒ _owner ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ‰€æœ‰è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰å¼•ãå‡ºã—å¯èƒ½ãªæ®‹é«˜ã‚’è¿”ã™
  * `function allowance(address _owner, address _spender) public view returns (uint256 remaining)`

### ERC-20 ã®ã‚¤ãƒ™ãƒ³ãƒˆ

* Transfer
  * ãƒˆãƒ¼ã‚¯ãƒ³ãŒè»¢é€ã•ã‚ŒãŸã¨ãã«ãƒˆãƒªã‚¬ã•ã‚Œã‚‹ï¼Žæ–°è¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ãŸã¨ãã«ã¯  _from ã‚¢ãƒ‰ãƒ¬ã‚¹ã« 0x0 ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
  * `event Transfer(address indexed _from, address indexed _to, uint256 _value)`
* Approval
  * approve ãŒæˆåŠŸã—ãŸã¨ãã«ãƒˆãƒªã‚¬ã•ã‚Œã‚‹ï¼Ž
  * `event Approval(address indexed _owner, address indexed _spender, uint256 _value)`

## ERC-20 ãƒˆãƒ¼ã‚¯ãƒ³ã®é€é‡‘ (transfer)

* ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ï¼ˆkey,å€¤ï¼‰æ§‹é€ ã§ç®¡ç†ã•ã‚Œã‚‹
  * ä¸»ã‚­ãƒ¼ã¯ï¼Œæ‰€æœ‰è€…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
  * å€¤ã¯ï¼Œæ‰€æœ‰è€…ã”ã¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®æ®‹é«˜
* ãƒˆãƒ¼ã‚¯ãƒ³ã®é€é‡‘ã¯ï¼Œé€é‡‘è€…ã¨å—é ˜è€…ã®ä¿æœ‰æ®‹é«˜ã®æ›´æ–°
  * ETHã®ä¿æœ‰ã¯å½±éŸ¿ã—ãªã„ï¼ˆã‚¬ã‚¹ä»£ã¯å¿…è¦ï¼‰
  
## ERC-20 ã®ä»£ç†é€é‡‘ (approve/tranferFrom)

* ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰è€…ãŒè‡ªåˆ†ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®é€é‡‘æ¨©é™ã‚’åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç§»è­²ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
  * ã‚¹ãƒžãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®è²©å£²ãªã©ã«åˆ©ç”¨ã•ã‚Œã‚‹
* æ‰¿èª (approve)ã®åˆ©ç”¨ä¾‹
  * ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰è€…ãŒæ‰¿èªè€…ã§
  * ãƒˆãƒ¼ã‚¯ãƒ³è²©å£²ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»£ç†é€é‡‘ã‚’æ‰¿èªã™ã‚‹
* ä»£ç†é€é‡‘ï¼ˆtranferFromï¼‰ã®ä¾‹
  * ãƒˆãƒ¼ã‚¯ãƒ³è²©å£²ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã« Eth ã§ãƒˆãƒ¼ã‚¯ãƒ³è³¼å…¥é‡‘é¡ãŒå…¥é‡‘ã•ã‚Œã‚‹ã¨
  * ãƒˆãƒ¼ã‚¯ãƒ³è²©å£²ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒè³¼å…¥è€…ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»£ç†é€é‡‘ã™ã‚‹


## OpenZeppelin ã®ERC20 ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

* OpenZeppelin ã®APIã‚µã‚¤ãƒˆ

[https://docs.openzeppelin.com/contracts/4.x/erc20](https://docs.openzeppelin.com/contracts/4.x/erc20)


## hardhat ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```bash
cd ~/hardhat
mkdir erc20
cd erc20
```

```bash
npm init -y
yarn add --dev hardhat
npx hardhat init

rm contracts/Lock.sol
rm test/Lock.js
rm ignition/modules/Lock.js
```

## OpenZeppelinã® ERC20 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

* OpenZeppelin ã® ERC20 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¾ã™

[https://docs.openzeppelin.com/contracts/4.x/erc20](https://docs.openzeppelin.com/contracts/4.x/erc20)

```bash
yarn add --dev @openzeppelin/contracts
```

## ERC20 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä½œæˆ

* ã“ã“ã§ã¯ï¼Œä»®ã«ãƒˆãƒ¼ã‚¯ãƒ³å JPQ ã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆåã‚’ JPYcoin ã¨ã—ã¾ã™ãŒï¼Œå¥½ããªåå‰ã«ã—ã¦ãã ã•ã„

```bash
nano contracts/JPYcoin.sol
```

ã“ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯ã€nameã€symbolã€initialSupplyï¼ˆåˆæœŸä¾›çµ¦é‡ï¼‰ã‚’å¼•æ•°ã«å–ã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®å…¨é‡ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒŸãƒ³ãƒˆã—ã¾ã™ã€‚

* ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ç¶™æ‰¿ã¨ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®é–“æŽ¥çš„åˆæœŸåŒ–

  * OpenZeppelin ã® ERC20 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ç¶™æ‰¿ã—ã¦å­ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ï¼Ž
  * ã“ã®å­ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã¯è¦ªã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®åˆæœŸåŒ–ã‚‚å¿…è¦ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼Ž

```js
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract JPYcoin is ERC20 {
  // ERC20 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•° (name, symbol,decimals)
    constructor(uint256 initialSupply) ERC20("JPYcoin", "JPQ") {
        _mint(msg.sender, initialSupply);
    }
}

```

## ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

```bash
npx hardhat compile

=>
Compiled 6 Solidity files successfully (evm target: paris).
```

## hardhat node ã®èµ·å‹•

```bash
npx hardhat node
```

### hardhat ignition ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ

* åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®æ“ä½œ

```bash
cd ~/hardhat/erc20
```

* deploy ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ


```bash
nano ignition/modules/JPYcoin.js
```


```js
const { buildModule } = require("@nomicfoundation/hardhat-ignition/modules");

// ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å JPYcoin
module.exports = buildModule("JPYcoin", (m) => {
  // ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå JPYcoin
  // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ã¨ã—ã¦åˆæœŸã®ãƒˆãƒ¼ã‚¯ä¾›çµ¦é‡ã‚’ 10ã®11ä¹—ã¨ã™ã‚‹
  const contract = m.contract("JPYcoin", [10**11]);
  return { contract };
});
```


### ãƒ­ãƒ¼ã‚«ãƒ«ãƒŽãƒ¼ãƒ‰ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx hardhat ignition deploy ignition/modules/JPYcoin.js --network localhost

=>
Hardhat Ignition ðŸš€

Deploying [ JPYcoin ]

Batch #1
  Executed JPYcoin#JPYcoin

[ JPYcoin ] successfully deployed ðŸš€

Deployed Addresses

JPYcoin#JPYcoin - 0x5FbDB2315678afecb367f032d93F642f64180aa3
```

## ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®æ“ä½œ

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®èµ·å‹•

```bash
npx hardhat console --network localhost 
```

### ERC20 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®æ“ä½œ

```js
> const JPYcoin_addr = "0x5FbDB2315678afecb367f032d93F642f64180aa3"
> const JPYcoin_Factory = await ethers.getContractFactory("JPYcoin")
// å½“è©²ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«æŽ¥ç¶šã™ã‚‹
> const JPYcoin = await JPYcoin_Factory.attach(JPYcoin_addr)

// ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
> const [owner, addr1, addr2] = await ethers.getSigners();

// ãƒˆãƒ¼ã‚¯ãƒ³ã®ç·ä¾›çµ¦é‡
> await JPYcoin.totalSupply()
100000000000n
// owner ã®ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰é‡
> await JPYcoin.balanceOf(owner)
100000000000n
> await JPYcoin.name()
'JPYcoin'
> await JPYcoin.symbol()
'JPQ'
> await JPYcoin.decimals()
18n
```

* ãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä»˜

```js
> await JPYcoin.transfer(addr1,8000000)
```

* ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰æ®‹é«˜ã®ç¢ºèª

```js
> await JPYcoin.balanceOf(owner)
99992000000n

> await JPYcoin.balanceOf(addr1)
8000000n
```

* addr1 ã«ãƒˆãƒ¼ã‚¯ãƒ³é€é‡‘ã‚’æ‰¿èªã™ã‚‹

```js
> await JPYcoin.approve(addr1, 1000)
```


## ãƒ¡ã‚¿ãƒžã‚¹ã‚¯

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

* `ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ`
* ç§˜å¯†éµã‚’å…¥åŠ›

### ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

* `+ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ` ã‚’ã‚¯ãƒªãƒƒã‚¯
* ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
* ãƒˆãƒ¼ã‚¯ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

## Faucet : ERC20ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ Eth ã§è³¼å…¥ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä½œæˆ

###  Eth ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è²©å£²ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä½œæˆæ‰‹é †

1. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒETHã‚’æ”¯æ‰•ã„å¯èƒ½
2. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒæ‰€æœ‰ã™ã‚‹ Eth ã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿ãŒå¼•ãå‡ºã—å¯èƒ½
2. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘å–ã‚Šå¯èƒ½
2. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒæ‰€æœ‰ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ transferFrom é–¢æ•°ã‚’ä½¿ã£ã¦è³¼å…¥è€…ã«é€ã‚‹ã€‚
3. ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã®ãƒ¬ãƒ¼ãƒˆã¯ 1ETH ã‚ãŸã‚Šã®ãƒˆãƒ¼ã‚¯ãƒ³é‡ã¨ã—ã¦æ±ºã‚ã‚‹

### ä½œæˆ

* æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œ
* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•

```bash
cd ~/hardhat/erc20
```

### ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰

```bash
nano contracts/JPYFaucet.sol
```

```js
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

// OpenZeppelinã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "./JPYcoin.sol";

contract JPYFaucet {
    JPYcoin public token;
    address public owner;
    uint256 public rate; // 1ETH ã‚ãŸã‚Šã®ãƒˆãƒ¼ã‚¯ãƒ³
    // åˆæœŸåŒ–æ™‚ã«ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã®ERC20ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨ ETH ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®äº¤æ›æ¯”çŽ‡ã‚’è¨­å®šã™ã‚‹
    constructor(uint256 _rate) {
        rate = _rate;
        owner = msg.sender; // ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‰€æœ‰è€…ã¨ã—ã¦è¨­å®š
    }

    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
    function setToken(JPYcoin _token) public {
        token = _token;
    }
    // ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ETHã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®é–¢æ•°
    // ã“ã® ETH ã¯ãƒˆãƒ¼ã‚¯ãƒ³è³¼å…¥ã®ä»£é‡‘ã«ãªã‚‹ã®ã§ï¼ŒETHã‚’å—é ˜ã™ã‚‹ã¨è³¼å…¥è€…ã«JPYãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»£ç†é€é‡‘ã—ã¾ã™
    function buyTokens() public payable {
        // msg.value     å‘¼ã³å‡ºã—ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§é€é‡‘ã•ã‚ŒãŸ ETH ã®é‡‘é¡ï¼ˆweiå˜ä½ï¼‰
        require(msg.value > 0, "ETH must be greater than 0");
        // è³¼å…¥ãƒˆãƒ¼ã‚¯ãƒ³é‡ã®è¨ˆç®—
        uint256 tokenAmount = msg.value * rate;
        // å£²ã‚Šæ‰‹ã«ååˆ†ãªãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚‹ã‹ç¢ºèª
        require(token.balanceOf(owner) >= tokenAmount, "Seller does not have enough tokens");
        // å£²ã‚Šæ‰‹ã‹ã‚‰è³¼å…¥è€…ã¸ã®ãƒˆãƒ¼ã‚¯ãƒ³é€ä¿¡
        require(token.transferFrom(owner, msg.sender, tokenAmount), "Token transfer failed");
    }
    // å£²ã‚Šæ‰‹(æ‰€æœ‰è€…)ãŒETHã‚’å¼•ãå‡ºã™ãŸã‚ã®é–¢æ•°
    function withdrawETH() public {
        require(msg.sender == owner, "Only owner can withdraw");
        payable(owner).transfer(address(this).balance);
    }
    // ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æ®‹é«˜ã‚’ç¢ºèªã™ã‚‹é–¢æ•°
    function getBalance() public view returns (uint256) {
        return address(this).balance;
    }
}


```

* ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

```bash
npx hardhat compile
```


### hardhat ignition ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä½œæˆ

```bash
nano ignition/modules/JPYFaucet.js
```


```js
const { buildModule } = require("@nomicfoundation/hardhat-ignition/modules");

module.exports = buildModule("JPYFaucet", (m) => {
  // ETHã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®äº¤æ›æ¯”çŽ‡ã¯ 20
  const JPYFaucet = m.contract("JPYFaucet", [20]);
  return { JPYFaucet };
});

```

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒŽãƒ¼ãƒ‰ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx hardhat ignition deploy ignition/modules/JPYFaucet.js --network localhost

=>
...
Batch #1
  Executed JPYFaucet#JPYFaucet

[ JPYFaucet ] successfully deployed ðŸš€

Deployed Addresses

JPYcoin#JPYcoin - 0x5FbDB2315678afecb367f032d93F642f64180aa3
JPYFaucet#JPYFaucet - 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
```

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®æ“ä½œ

* ERC20ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ“ä½œã®ç¶šã

```bash
npx hardhat console --network localhost 
```

```js
// JPYFaucet
> const JPYFaucet_addr = "0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9"
> const JPYFaucet_Factory = await ethers.getContractFactory("JPYFaucet")
> const JPYFaucet = await JPYFaucet_Factory.attach(JPYFaucet_addr)
```

```js
// JPYcoin
> const JPYcoin_addr = "0x5FbDB2315678afecb367f032d93F642f64180aa3"
> const JPYcoin_Factory = await ethers.getContractFactory("JPYcoin")
> const JPYcoin = await JPYcoin_Factory.attach(JPYcoin_addr)
```

* JPYcoin ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦è¨­å®šã™ã‚‹

```js
> await JPYFaucet.setToken(JPYcoin);
```

* ERC20ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³è³¼å…¥ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«å¯¾ã—ã¦ä»£ç†é€é‡‘ã‚’è¨±å¯ã™ã‚‹ï¼ˆ1000000000ãƒˆãƒ¼ã‚¯ãƒ³ã¾ã§ï¼‰

```js
> await JPYcoin.approve(JPYFaucet,1000000000);

```

* ãƒ†ã‚¹ãƒˆç”¨ã‚¢ãƒ‰ãƒ¬ã‚¹

```js
> const [owner, addr1, addr2] = await ethers.getSigners();
```

* ãƒˆãƒ¼ã‚¯ãƒ³è³¼å…¥ (ETH ã‚’ 20000 wei) é€é‡‘

```js
> await JPYFaucet.buyTokens({value: 20000})

```

* ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰é‡ã®ç¢ºèª

```js
> await JPYcoin.balanceOf(addr1.address)
8000000n
> await JPYcoin.balanceOf(owner.address)
99992000000n

```


* ãƒˆãƒ¼ã‚¯ãƒ³è³¼å…¥ (ETH ã‚’ 50000 wei) é€é‡‘

```js
> await JPYF.buyTokens({value: 50000})

```

* ãƒˆãƒ¼ã‚¯ãƒ³ä¿æœ‰é‡ã®ç¢ºèª

```js
> await JPQ.balanceOf(addr1.address)
8000000n
> await JPQ.balanceOf(owner.address)
99992000000n

```